<!--
  -  Windows Event Channel ruleset for the Application channel 
  -  Created by Wazuh, Inc.
  -  Copyright (C) 2015-2019, Wazuh Inc.
  -  This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2.
  -  ID range: 61100 - 61600
-->

<group name="windows,sysmon,">
  <rule id="61100" level="0">
    <if_sid>60004</if_sid>
    <field name="win.system.severityValue">^INFORMATION</field>
    <description>Windows informational event</description>
    <options>no_full_log</options>
  </rule>

  <rule id="61101" level="0">
    <if_sid>60004</if_sid>
    <field name="win.system.severityValue">^WARNING</field>
    <description>Windows warning event</description>
    <options>no_full_log</options>
    <group>gpg13_4.12,</group>
  </rule>

  <!--{"win":{"system":{"providerName":"NetBT","eventID":"4321","level":"2","task":"0","keywords":"0x80000000000000","systemTime":"2018-12-18T10:55:40.107861400Z","eventRecordID":"1701","channel":"System","computer":"qnu","severityValue":"ERROR","message":"Le nom \\\"WORKGROUP      :1d\\\" n’a pas pu être enregistré sur l’interface avec l’adresse IP 10.0.2.15. L’ordinateur avec l’adresse IP 10.0.2.2 n’a pas permis que le nom soit réclamé par cet ordinateur."},"eventdata":{"data":"","data":"WORKGROUP      :1d","data":"10.0.2.15","data":"10.0.2.2","binary":"00000000040032000000000E11000C001010000010000C029000000000000000000000000000000"}}}-->
  <rule id="61102" level="5">
    <if_sid>60004</if_sid>
    <field name="win.system.severityValue">^ERROR</field>
    <description>Windows System error event</description>
    <options>no_full_log</options>
    <group>system_error,gpg13_4.3,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61103" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^1$</field>
    <description>Sysmon - Event 1: Process creation $(win.eventdata.description)</description>
    <options>no_full_log</options>
    <group>sysmon_event1,</group>
  </rule>

  <rule id="61104" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^2$</field>
    <description>Sysmon - Event 2: A process changed a file creation time by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event2,</group>
  </rule>

  <rule id="61105" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^3$</field>
    <description>Sysmon - Event 3: Network connection by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event3,</group>
  </rule>

  <rule id="61106" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^4$</field>
    <description>Sysmon - Event 4: Sysmon service state changed by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event4,</group>
  </rule>

  <rule id="61107" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^5$</field>
    <description>Sysmon - Event 5: Process terminated by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event5,</group>
  </rule>

  <rule id="61108" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^6$</field>
    <description>Sysmon - Event 6: Driver loaded by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event6,</group>
  </rule>

  <rule id="61109" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^7$</field>
    <description>Sysmon - Event 7: Image loaded by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event7,</group>
  </rule>

  <rule id="61110" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^8$</field>
    <description>Sysmon - Event 8: CreateRemoteThread by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event8,</group>
  </rule>

  <rule id="61111" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^9$</field>
    <description>Sysmon - Event 9: RawAccessRead by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event9,</group>
  </rule>

  <rule id="61112" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^10$</field>
    <description>Sysmon - Event 10: ProcessAccess by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event_10,</group>
  </rule>

  <rule id="61113" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^11$</field>
    <description>Sysmon - Event 11: FileCreate by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event_11,</group>
  </rule>

  <rule id="61114" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^12$</field>
    <description>Sysmon - Event 12: RegistryEvent (Object create and delete) by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event_12,</group>
  </rule>

  <rule id="61115" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^13$</field>
    <description>Sysmon - Event 13: RegistryEvent (Value Set) by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event_13,</group>
  </rule>

  <rule id="61116" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^14$</field>
    <description>Sysmon - Event 14: RegistryEvent (Key and Value Rename) by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event_14,</group>
  </rule>

  <rule id="61117" level="0">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^15$</field>
    <description>Sysmon - Event 15: FileCreateStreamHash by $(win.eventdata.sourceImage)</description>
    <options>no_full_log</options>
    <group>sysmon_event_15,</group>
  </rule>
</group>

<group name="windows,sysmon,sysmon_process-anomalies,">
  <rule id="61118" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="win.eventdata.image">svchost.exe</field>
    <description>Sysmon - Suspicious Process - svchost.exe</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61119" level="0">
    <if_sid>61118</if_sid>
    <field name="win.eventdata.parentImage">\\services.exe</field>
    <description>Sysmon - Legitimate Parent Image - svchost.exe</description>
  </rule>

  <rule id="61120" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="win.eventdata.image">lsm.exe</field>
    <description>Sysmon - Suspicious Process - lsm.exe</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61121" level="0">
    <if_sid>61120</if_sid>
    <field name="win.eventdata.parentImage">wininit.exe</field>
    <description>Sysmon - Legitimate Parent Image - lsm.exe</description>
  </rule>

  <rule id="61122" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="win.eventdata.parentImage">lsm.exe</field>
    <description>Sysmon - Suspicious Process - lsm.exe is a Parent Image</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61123" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="win.eventdata.image">csrss.exe</field>
    <description>Sysmon - Suspicious Process - csrss.exe</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61124" level="0">
    <if_sid>61123</if_sid>
    <field name="win.eventdata.parentImage">smss.exe</field>
    <description>Sysmon - Legitimate Parent Image - csrss.exe</description>
  </rule>

  <rule id="61125" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="win.eventdata.image">lsass.exe</field>
    <description>Sysmon - Suspicious Process - lsass</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61126" level="0">
    <if_sid>61125</if_sid>
    <field name="win.eventdata.parentImage">wininit.exe</field>
    <description>Sysmon - Legitimate Parent Image - lsass.exe</description>
  </rule>

  <rule id="61127" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="win.eventdata.parentImage">lsass.exe</field>
    <description>Sysmon - Suspicious Process - lsass.exe is a Parent Image</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61128" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="win.eventdata.image">winlogon.exe</field>
    <description>Sysmon - Suspicious Process - winlogon.exe</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61129" level="0">
    <if_sid>61128</if_sid>
    <field name="win.eventdata.parentImage">smss.exe</field>
    <description>Sysmon - Legitimate Parent Image - winlogon.exe</description>
  </rule>

  <rule id="61130" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="win.eventdata.image">wininit.exe</field>
    <description>Sysmon - Suspicious Process - wininit</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61131" level="0">
    <if_sid>61130</if_sid>
    <field name="win.eventdata.parentImage">smss.exe</field>
    <description>Sysmon - Legitimate Parent Image - wininit.exe</description>
  </rule>

  <rule id="61132" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="win.eventdata.image">smss.exe</field>
    <description>Sysmon - Suspicious Process - smss.exe</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61133" level="0">
    <if_sid>61132</if_sid>
    <field name="win.eventdata.parentImage">system</field>
    <description>Sysmon - Legitimate Parent Image - smss.exe</description>
  </rule>

  <rule id="61134" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="win.eventdata.image">taskhost.exe</field>
    <description>Sysmon - Suspicious Process - taskhost.exe</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61135" level="0">
    <if_sid>61134</if_sid>
    <field name="win.eventdata.parentImage">services.exe|svchost.exe</field>
    <description>Sysmon - Legitimate Parent Image - taskhost.exe</description>
  </rule>

  <rule id="61136" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="win.eventdata.image">/services.exe</field>
    <description>Sysmon - Suspicious Process - services.exe</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61137" level="0">
    <if_sid>61136</if_sid>
    <field name="win.eventdata.parentImage">wininit.exe</field>
    <description>Sysmon - Legitimate Parent Image - services.exe</description>
  </rule>

  <rule id="61138" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="win.eventdata.image">dllhost.exe</field>
    <description>Sysmon - Suspicious Process - dllhost.exe</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61139" level="0">
    <if_sid>61138</if_sid>
    <field name="win.eventdata.parentImage">svchost.exe|services.exe</field>
    <description>Sysmon - Legitimate Parent Image - dllhost.exe</description>
  </rule>

  <rule id="61140" level="12">
    <if_group>sysmon_event1</if_group>
    <field name="win.eventdata.image">\\explorer.exe</field>
    <description>Sysmon - Suspicious Process - explorer.exe</description>
    <group>pci_dss_10.6.1,pci_dss_11.4,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61141" level="0">
    <if_sid>61140</if_sid>
    <field name="win.eventdata.parentImage">userinit.exe</field>
    <description>Sysmon - Legitimate Parent Image - explorer.exe</description>
  </rule>
</group>