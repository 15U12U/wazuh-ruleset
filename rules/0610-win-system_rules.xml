<!--
  -  Windows Event Channel ruleset for the Sysmon channel 
  -  Created by Wazuh, Inc.
  -  Copyright (C) 2015-2019, Wazuh Inc.
  -  This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2.
  -  ID range: 61100 - 61600
-->

<var name="MS_FREQ">8</var>

<group name="windows, windows_system">
  <rule id="61100" level="0">
    <if_sid>60002</if_sid>
    <field name="win.system.severityValue">^INFORMATION</field>
    <description>Windows System informational event</description>
    <options>no_full_log</options>
  </rule>

  <rule id="61101" level="0">
    <if_sid>60002</if_sid>
    <field name="win.system.severityValue">^WARNING</field>
    <description>Windows System warning event</description>
    <options>no_full_log</options>
    <group>gpg13_4.12,</group>
  </rule>

  <rule id="61102" level="5">
    <if_sid>60002</if_sid>
    <field name="win.system.severityValue">^ERROR</field>
    <description>Windows System error event</description>
    <options>no_full_log</options>
    <group>system_error,gpg13_4.3,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="61103" level="9">
    <if_sid>60002</if_sid>
    <field name="win.system.severityValue">^CRITICAL</field>
    <description>Windows System critical event</description>
    <options>no_full_log</options>
    <group>system_error,gpg13_4.3,gdpr_IV_35.7.d,</group>
  </rule>

  <!-- Some services change their startup type automatically -->
  <rule id="61104" level="3">
    <if_sid>61100</if_sid>
    <field name="win.system.eventID">^7040$</field>
    <group>policy_changed,pci_dss_10.6,gdpr_IV_35.7.d,</group>
    <description>Service startup type was changed</description>
    <options>no_full_log</options>
    <info type="text">This does not appear to be logged on Windows 2000</info>
  </rule>

  <rule id="61105" level="9">
    <if_sid>61103</if_sid>
    <field name="win.system.eventID">^41$</field>
    <field name="win.system.providerName">^Microsoft-Windows-Kernel-Power</field>
    <description>The system stopped responding, crashed or lost power unexpectedly</description>
    <options>no_full_log</options>
  </rule>

  <rule id="61106" level="5">
    <if_sid>61101</if_sid>
    <field name="win.system.eventID">^219$</field>
    <field name="win.system.providerName">^Microsoft-Windows-Kernel-PnP</field>
    <description>The driver $(win.eventdata.failureName) failed to load for the device $(win.eventdata.driverName)</description>
    <options>no_full_log</options>
  </rule>

  <rule id="61107" level="5">
    <if_sid>61102</if_sid>
    <field name="win.system.eventID">^7031$</field>
    <field name="win.eventdata.param1">\.+</field>
    <field name="win.system.providerName">^Service Control Manager</field>
    <description>$(win.eventdata.param1) terminated unexpectedly</description>
    <options>no_full_log</options>
  </rule>

  <rule id="61108" level="5">
    <if_sid>61102</if_sid>
    <field name="win.system.eventID">^7022$</field>
    <field name="win.system.providerName">^Service Control Manager</field>
    <description>The Windows Search service hung on starting</description>
    <options>no_full_log</options>
  </rule>

  <rule id="61109" level="5">
    <if_sid>61101</if_sid>
    <field name="win.system.eventID">^1014$</field>
    <field name="win.system.providerName">^Microsoft-Windows-DNS-Client</field>
    <description>Name resolution for the name $(win.eventdata.queryName) timed out</description>
    <options>no_full_log</options>
  </rule>

  <rule id="61106" level="10" frequency="$MS_FREQ" timeframe="240">
    <if_matched_sid>61102</if_matched_sid>
    <description>Multiple System error events</description>
    <options>no_full_log</options>
  </rule>

  <rule id="61107" level="10" frequency="$MS_FREQ" timeframe="120">
    <if_matched_sid>61101</if_matched_sid>
    <description>Multiple System WARNING events</description>
    <options>no_full_log</options>
  </rule>

  <rule id="61108" level="10" frequency="$MS_FREQ" timeframe="120">
    <if_matched_sid>61103</if_matched_sid>
    <description>Multiple System CRITICAL events</description>
    <options>no_full_log</options>
  </rule>

</group>