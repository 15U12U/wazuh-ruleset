# Security Configuration Assessment
# CIS Checks for CentOS 6
# Copyright (C) 2015-2020, Wazuh Inc.
#
# This program is free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public
# License (version 2) as published by the FSF - Free Software
# Foundation
#
# Based on:
# Center for Internet Security CentOS 6 Benchmark v2.1.0 - 12-27-2017

policy:
  id: "cis_centos6"
  file: "cis_centos6_linux.yml"
  name: "CIS Benchmark for CentOS 6"
  description: "This document provides prescriptive guidance for establishing a secure configuration posture for CentOS 6 systems running on x86 and x64 platforms. This document was tested against CentOS 6."
  references:
    - https://www.cisecurity.org/cis-benchmarks/

requirements:
  title: "Check CentOS 6 platform"
  description: "Requirements for running the policy against CentOS 6."
  condition: any
  rules:
#    - 'f:/etc/redhat-release -> r:^Red Hat Enterprise Linux && r:release 6'
    - 'f:/etc/redhat-release -> r:^CentOS && r:release 6'
#    - 'f:/etc/redhat-release -> r:^Cloud && r:release 6'
#    - 'f:/etc/redhat-release -> r:^Oracle && r:release 6'
#    - 'f:/etc/redhat-release -> r:^Better && r:release 6'
#    - 'f:/etc/redhat-release -> r:^OpenVZ && r:release 6'
#    - 'f:/etc/system-release -> r:^Amazon && r:release 2'

variables:
  $sshd_file: /etc/ssh/sshd_config

checks:

# 1.1.1.1 cramfs: filesystem
  - id: 5500 
    title: "Ensure mounting of cramfs filesystems is disabled"
    description: "The cramfs filesystem type is a compressed read-only Linux filesystem embedded in small footprint systems. A cramfs image can be used without having to first decompress the image."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the server. If this filesystem type is not needed, disable it."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install cramfs /bin/true. Run the following command to unload the cramfs module: rmmod cramfs"
    compliance:
      - cis: ["1.1.1.1"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.5"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:modprobe -n -v cramfs -> r:install /bin/true|Module cramfs not found'
      - 'not c:lsmod -> r:cramfs'

# 1.1.1.2 freevxfs: filesystem
  - id: 5501 
    title: "Ensure mounting of freevxfs filesystems is disabled"
    description: "The freevxfs filesystem type is a free version of the Veritas type filesystem. This is the primary filesystem type for HP-UX operating systems."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install freevxfs /bin/true. Run the following command to unload the freevxfs module: rmmod freevxfs"
    compliance:
      - cis: ["1.1.1.2"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.5"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:modprobe -n -v freevxfs -> r:install /bin/true|Module freevxfs not found'
      - 'not c:lsmod -> r:freevxfs'

# 1.1.1.3 jffs2: filesystem
  - id: 5502 
    title: "Ensure mounting of jffs2 filesystems is disabled"
    description: "The jffs2 (journaling flash filesystem 2) filesystem type is a log-structured filesystem used in flash memory devices."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install jffs2 /bin/true. Run the following command to unload the jffs2 module: rmmod jffs2"
    compliance:
      - cis: ["1.1.1.3"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.5"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:modprobe -n -v jffs2 -> r:install /bin/true|Module jffs2 not found'
      - 'not c:lsmod -> r:jffs2'

# 1.1.1.4 hfs: filesystem
  - id: 5503 
    title: "Ensure mounting of hfs filesystems is disabled"
    description: "The hfs filesystem type is a hierarchical filesystem that allows you to mount Mac OS filesystems."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install hfs /bin/true. Run the following command to unload the hfs module: rmmod hfs"
    compliance:
      - cis: ["1.1.1.4"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.5"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:modprobe -n -v hfs -> r:install /bin/true|Module hfs not found'
      - 'not c:lsmod -> r:hfs'
# 1.1.1.5 hfsplus: filesystem
  - id: 5504 
    title: "Ensure mounting of hfsplus filesystems is disabled"
    description: "The hfsplus filesystem type is a hierarchical filesystem designed to replace hfs that allows you to mount Mac OS filesystems."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install hfsplus /bin/true. Run the following command to unload the hfsplus module: rmmod hfsplus"
    compliance:
      - cis: ["1.1.1.5"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.5"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:modprobe -n -v hfsplus -> r:install /bin/true|Module hfsplus not found'
      - 'not c:lsmod -> r:hfsplus'
# 1.1.1.6 squashfs: filesystem
  - id: 5505 
    title: "Ensure mounting of squashfs filesystems is disabled"
    description: "The squashfs filesystem type is a compressed read-only Linux filesystem embedded in small footprint systems (similar to cramfs ). A squashfs image can be used without having to first decompress the image."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install squashfs /bin/true. Run the following command to unload the squashfs module: rmmod squashfs"
    compliance:
      - cis: ["1.1.1.6"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.5"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:modprobe -n -v squashfs -> r:install /bin/true|Module squashfs not found'
      - 'not c:lsmod -> r:squashfs'
# 1.1.1.7 udfs: filesystem
  - id: 5506 
    title: "Ensure mounting of udf filesystems is disabled"
    description: "The udf filesystem type is the universal disk format used to implement ISO/IEC 13346 and ECMA-167 specifications. This is an open vendor filesystem type for data storage on a broad range of media. This filesystem type is necessary to support writing DVDs and newer optical disc formats."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install udf /bin/true. Run the following command to unload the udf module: rmmod udf"
    compliance:
      - cis: ["1.1.1.7"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.5"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:modprobe -n -v udf -> r:install /bin/true|Module udf not found'
      - 'not c:lsmod -> r:udf'
# 1.1.1.8 FAT: filesystem
  - id: 5507 
    title: "Ensure mounting of FAT filesystems is disabled"
    description: "The FAT filesystem format is primarily used on older windows systems and portable USB drives or flash modules. It comes in three types FAT12 , FAT16 , and FAT32 all of which are supported by the vfat kernel module."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install vfat /bin/true. Run the following command to unload the vfat module: rmmod vfat"
    compliance:
      - cis: ["1.1.1.8"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.5"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:modprobe -n -v vfat -> r:install /bin/true|Module vfat not found'
      - 'not c:lsmod -> r:vfat'

# 1.1.2 /tmp: partition
  - id: 5508 
    title: "Ensure separate partition exists for /tmp"
    description: "The /tmp directory is a world-writable directory used for temporary storage by all users and some applications."
    rationale: "Since the /tmp directory is intended to be world-writable, there is a risk of resource exhaustion if it is not bound to a separate partition. In addition, making /tmp its own file system allows an administrator to set the noexec option on the mount, making /tmp useless for an attacker to install executable code. It would also prevent an attacker from establishing a hardlink to a system setuid program and wait for it to be updated. Once the program was updated, the hardlink would be broken and the attacker would have his own copy of the program. If the program happened to have a security vulnerability, the attacker could continue to exploit the known flaw."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /tmp. For systems that were previously installed, create a new partition for /tmp if not using tmpfs. Enable systemd /tmp mounting"
    compliance:
      - cis: ["1.1.2"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:mount -> r:\s/tmp\s'

# 1.1.3 /tmp: nodev
  - id: 5509 
    title: "Ensure nodev option set on /tmp partition"
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /tmp filesystem is not intended to support devices, set this option to ensure that users cannot attempt to create block or character special devices in /tmp."
    remediation: "Edit /etc/systemd/system/local-fs.target.wants/tmp.mount to add nodev to the /tmp mount options: Options=mode=1777,strictatime,noexec,nodev,nosuid"
    compliance:
      - cis: ["1.1.3"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:mount -> r:\s/tmp\s && r:nodev'

# 1.1.4 /tmp: nosuid
  - id: 5510 
    title: "Ensure nosuid option set on /tmp partition"
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /tmp filesystem is only intended for temporary file storage, set this option to ensure that users cannot create setuid files in /tmp."
    remediation: "Edit /etc/systemd/system/local-fs.target.wants/tmp.mount to add nosuid to the /tmp mount options: Options=mode=1777,strictatime,noexec,nodev,nosuid"
    compliance:
      - cis: ["1.1.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:mount -> r:\s/tmp\s && r:nosuid'

# 1.1.5 /tmp: noexec
  - id: 5511 
    title: "Ensure noexec option set on /tmp partition"
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Since the /tmp filesystem is only intended for temporary file storage, set this option to ensure that users cannot run executable binaries from /tmp."
    remediation: "Edit /etc/systemd/system/local-fs.target.wants/tmp.mount to add noexec to the /tmp mount options: Options=mode=1777,strictatime,noexec,nodev,nosuid"
    compliance:
      - cis: ["1.1.5"]
      - cis_csc: ["2"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:mount -> r:\s/tmp\s && r:noexec'

# 1.1.6 Build considerations - Partition scheme.
  - id: 5512 
    title: "Ensure separate partition exists for /var"
    description: "The /var directory is used by daemons and other system services to temporarily store dynamic data. Some directories created by these processes may be world-writable."
    rationale: "Since the /var directory may contain world-writable files and directories, there is a risk of resource exhaustion if it is not bound to a separate partition."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /var. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    compliance:
      - cis: ["1.1.6"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:mount -> r:\s/var\s'

# 1.1.7 bind mount /var/tmp to /tmp
  - id: 5513 
    title: "Ensure separate partition exists for /var/tmp"
    description: "The /var/tmp directory is a world-writable directory used for temporary storage by all users and some applications."
    rationale: "Since the /var/tmp directory is intended to be world-writable, there is a risk of resource exhaustion if it is not bound to a separate partition. In addition, making /var/tmp its own file system allows an administrator to set the noexec option on the mount, making /var/tmp useless for an attacker to install executable code."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /var/tmp. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    compliance:
      - cis: ["1.1.7"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:mount -> r:\s/var/tmp\s'

# 1.1.8 nodev set on /var/tmp
  - id: 5514 
    title: "Ensure nodev option set on /var/tmp partition"
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /var/tmp filesystem is not intended to support devices, set this option to ensure that users cannot attempt to create block or character special devices in /var/tmp ."
    remediation: "Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /var/tmp partition. See the fstab(5) manual page for more information."
    compliance:
      - cis: ["1.1.8"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:mount -> r:\s/var/tmp\s && r:nodev'

# 1.1.9 nosuid set on /var/tmp
  - id: 5515 
    title: "Ensure nosuid option set on /var/tmp partition"
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /var/tmp filesystem is only intended for temporary file storage, set this option to ensure that users cannot create setuid files in /var/tmp."
    remediation: "Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /var/tmp partition. See the fstab(5) manual page for more information."
    compliance:
      - cis: ["1.1.9"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:mount -> r:\s/var/tmp\s && r:nosuid'

# 1.1.10 noexec set on /var/tmp
  - id: 5516 
    title: "Ensure noexec option set on /var/tmp partition"
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Since the /var/tmp filesystem is only intended for temporary file storage, set this option to ensure that users cannot run executable binaries from /var/tmp."
    remediation: "Edit the /etc/fstab file and add noexec to the fourth field (mounting options) for the /var/tmp partition. See the fstab(5) manual page for more information."
    compliance:
      - cis: ["1.1.10"]
      - cis_csc: ["2"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:mount -> r:\s/var/tmp\s && r:noexec'

# 1.1.11 /var/log: partition
  - id: 5517 
    title: "Ensure separate partition exists for /var/log"
    description: "The /var/log directory is used by system services to store log data ."
    rationale: "There are two important reasons to ensure that system logs are stored on a separate partition: protection against resource exhaustion (since logs can grow quite large) and protection of audit data."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /var/log. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    compliance:
      - cis: ["1.1.11"]
      - cis_csc: ["6.3"]
      - pci_dss: ["2.2.4","10.7"]
      - nist_800_53: ["CM.1"]

    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:mount -> r:\s/var/log\s'

# 1.1.12 /var/log/audit: partition
  - id: 5518 
    title: "Ensure separate partition exists for /var/log/audit"
    description: "The auditing daemon, auditd , stores log data in the /var/log/audit directory."
    rationale: "There are two important reasons to ensure that data gathered by auditd is stored on a separate partition: protection against resource exhaustion (since the audit.log file can grow quite large) and protection of audit data."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /var/log/audit. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    compliance:
      - cis: ["1.1.12"]
      - cis_csc: ["6.3"]
      - pci_dss: ["2.2.4","10.7"]
      - nist_800_53: ["CM.1"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:mount -> r:\s/var/log/audit\s'

# 1.1.13 /home: partition
  - id: 5519 
    title: "Ensure separate partition exists for /home"
    description: "The /home directory is used to support disk storage needs of local users."
    rationale: "If the system is intended to support local users, create a separate partition for the /home directory to protect against resource exhaustion and restrict the type of files that can be stored under /home."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /home. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    compliance:
      - cis: ["1.1.13"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:mount -> r:\s/home\s'

# 1.1.14 /home: nodev
  - id: 5520 
    title: "Ensure nodev option set on /home partition"
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the user partitions are not intended to support devices, set this option to ensure that users cannot attempt to create block or character special devices."
    remediation: "Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /home partition. # mount -o remount,nodev /home"
    compliance:
      - cis: ["1.1.14"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:mount -> r:\s/home\s && r:nodev'

# 1.1.15 /dev/shm: nodev
  - id: 5521 
    title: "Ensure nodev option set on /dev/shm partition"
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /dev/shm filesystem is not intended to support devices, set this option to ensure that users cannot attempt to create special devices in /dev/shm partitions."
    remediation: "Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /dev/shm partition. Run the following command to remount /dev/shm: # mount -o remount,nodev /dev/shm"
    compliance:
      - cis: ["1.1.15"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:mount -> r:\s/dev/shm\s && r:nodev'

# 1.1.16 /dev/shm: nosuid
  - id: 5522 
    title: "Ensure nosuid option set on /dev/shm partition"
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Setting this option on a file system prevents users from introducing privileged programs onto the system and allowing non-root users to execute them."
    remediation: "Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /dev/shm partition. Run the following command to remount /dev/shm: # mount -o remount,nosuid /dev/shm"
    compliance:
      - cis: ["1.1.16"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:mount -> r:\s/dev/shm\s && r:nosuid'

# 1.1.17 /dev/shm: noexec
  - id: 5523 
    title: "Ensure noexec option set on /dev/shm partition"
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Setting this option on a file system prevents users from executing programs from shared memory. This deters users from introducing potentially malicious software on the system."
    remediation: "Edit the /etc/fstab file and add noexec to the fourth field (mounting options) for the /dev/shm partition. Run the following command to remount /dev/shm: # mount -o remount,noexec /dev/shm"
    compliance:
      - cis: ["1.1.17"]
      - cis_csc: ["2"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:mount -> r:\s/dev/shm\s && r:noexec'

# 1.1.22 Disable Automounting
  - id: 5524 
    title: "Disable Automounting"
    description: "autofs allows automatic mounting of devices, typically including CD/DVDs and USB drives."
    rationale: "With automounting enabled anyone with physical access could attach a USB drive or disc and have its contents available in system even if they lacked permissions to mount it themselves."
    remediation: "Run the following command to disable autofs : chkconfig autofs off"
    compliance:
      - cis: ["1.1.22"]
      - cis_csc: ["8.3"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*autofs:\s*\t*on'

###############################################
# 1.2 Configure Software Updates
###############################################

# 1.2.3 Activate gpgcheck
  - id: 5525 
    title: "Ensure gpgcheck is globally activated"
    description: "The gpgcheck option, found in the main section of the /etc/yum.conf and individual /etc/yum/repos.d/* files determines if an RPM package's signature is checked prior to its installation."
    rationale: "It is important to ensure that an RPM's package signature is always checked prior to installation to ensure that the software is obtained from a trusted source."
    remediation: "Edit /etc/yum.conf and set ' gpgcheck=1 ' in the [main] section. Edit any failing files in /etc/yum.repos.d/* and set all instances of gpgcheck to ' 1 '."
    compliance:
      - cis: ["1.2.3"]
      - cis_csc: ["4.5"]
      - pci_dss: ["6.2"]
      - nist_800_53: ["SI.2","SA.11","SI.4"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      
    condition: all
    rules:
      - 'f:/etc/yum.conf -> r:gpgcheck=1'
      - 'not c:grep -Rh ^gpgcheck /etc/yum.repos.d/ -> r:gpgcheck=0'


###############################################
# 1.3 Filesystem Integrity Checking
###############################################

# 1.3.1 install AIDE
  - id: 5526 
    title: "Ensure AIDE is installed"
    description: "AIDE takes a snapshot of filesystem state including modification times, permissions, and file hashes which can then be used to compare against the current state of the filesystem to detect modifications to the system."
    rationale: "By monitoring the filesystem state compromised files can be detected to prevent or limit the exposure of accidental or malicious misconfigurations or modified binaries."
    remediation: "Run the following command to install aide: yum install aide // Configure AIDE as appropriate for your environment. Consult the AIDE documentation for options. Initialize AIDE: aide --init && mv /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz"
    compliance:
      - cis: ["1.3.1"]
      - cis_csc: ["3.5"]
      - pci_dss: ["11.5"]
    references: "AIDE stable manual: http://aide.sourceforge.net/stable/manual.html"
    condition: all
    rules:
      - 'c:rpm -q aide -> r:aide-\S*'

# 1.3.2 AIDE regular checks
  - id: 5527 
    title: "Ensure filesystem integrity is regularly checked"
    description: "Periodic checking of the filesystem integrity is needed to detect changes to the filesystem."
    rationale: "Periodic file checking allows the system administrator to determine on a regular basis if critical files have been changed in an unauthorized fashion."
    remediation: "Run the following command: crontab -u root -e // Add the following line to the crontab: 0 5 * * * /usr/sbin/aide --check  // Notes: The checking in this recommendation occurs every day at 5am. Alter the frequency and time of the checks in compliance with site policy.  "
    compliance:
      - cis: ["1.3.2"]
      - cis_csc: ["3.5"]
      - pci_dss: ["11.5"]
    condition: any
    rules:
      - 'c:crontab -u root -l -> r:aide'
      - 'c:grep -r aide /etc/cron.* /etc/crontab -> r:aide'

###############################################
# 1.4 Secure Boot Settings
###############################################
# 1.4.1 Configure bootloader
  - id: 5528 
    title: "Ensure permissions on bootloader config are configured"
    description: "The grub configuration file contains information on boot settings and passwords for unlocking boot options. The grub configuration is usually located at /boot/grub2/grub.cfg and linked as /etc/grub2.cfg . Additional settings can be found in the /boot/grub2/user.cfg file."
    rationale: "Setting the permissions to read and write for root only prevents non-root users from seeing the boot parameters or changing them. Non-root users who read the boot parameters may be able to identify weaknesses in security upon boot and be able to exploit them."
    remediation: "Run the following commands to set permissions on your grub configuration: chown root:root /boot/grub2/grub.cfg, chmod og-rwx /boot/grub2/grub.cfg, chown root:root /boot/grub2/user.cfg, chmod og-rwx /boot/grub2/user.cfg"
    compliance:
      - cis: ["1.4.1"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:stat /boot/grub2/grub.cfg -> r:Access:\s*\(0600/-rw-------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'
      - 'c:stat /boot/grub2/user.cfg -> r:Access:\s*\(0600/-rw-------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)|cannot stat'

# 1.4.2 Set Boot Loader Password (Scored)
  - id: 5529 
    title: "Ensure bootloader password is set"
    description: "Setting the boot loader password will require that anyone rebooting the system must enter a password before being able to set command line boot parameters."
    rationale: "Requiring a boot password upon execution of the boot loader will prevent an unauthorized user from entering boot parameters or changing the boot partition. This prevents users from weakening security (e.g. turning off SELinux at boot time)."
    remediation: "Create an encrypted password with grub2-setpassword: # grub2-setpassword"
    compliance:
      - cis: ["1.4.2"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'f:/boot/grub2/grub.cfg -> r:^GRUB2_PASSWORD\s*=\.+'

# 1.4.3 Single user authentication
  - id: 5530 
    title: "Ensure authentication required for single user mode"
    description: "Single user mode (rescue mode) is used for recovery when the system detects an issue during boot or by manual selection from the bootloader."
    rationale: "Requiring authentication in single user mode (rescue mode) prevents an unauthorized user from rebooting the system into single user to gain root privileges without credentials."
    remediation: "Edit /usr/lib/systemd/system/rescue.service and /usr/lib/systemd/system/emergency.service and set ExecStart to use /sbin/sulogin or /usr/sbin/sulogin: ExecStart=-/bin/sh -c \"/sbin/sulogin; /usr/bin/systemctl --fail --no-block default\" "
    compliance:
      - cis: ["1.4.3"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'f:/usr/lib/systemd/system/rescue.service -> r:ExecStart=-/bin/sh -c "/sbin/sulogin; /usr/bin/systemctl --fail --no-block default"|ExecStart=-/bin/sh -c "/usr/sbin/sulogin; /usr/bin/systemctl --fail --no-block default"'
      - 'f:/usr/lib/systemd/system/emergency.service -> r:ExecStart=-/bin/sh -c "/sbin/sulogin; /usr/bin/systemctl --fail --no-block default"|ExecStart=-/bin/sh -c "/usr/sbin/sulogin; /usr/bin/systemctl --fail --no-block default"'

# 1.4.4 Ensure interactive boot is not enabled (Scored)
  - id: 5730
    title: "Ensure interactive boot is not enabled"
    description: "Interactive boot allows console users to interactively select which services start on boot. The PROMPT option provides console users the ability to interactively boot the system and select which services to start on boot . "
    rationale: "Turn off the PROMPT option on the console to prevent console users from potentially overriding established security settings. "
    remediation: "Edit the /etc/sysconfig/init file and set PROMPT to ' no ': PROMPT=no"
    compliance:
      - cis: ["1.4.4"]
      - cis_csc: ["5.1"]
    condition: all
    rules:
      - 'f:/etc/sysconfig/init -> r:PROMPT\s*=\s*no'

###############################################
# 1.5 Additional Process Hardening
###############################################
# 1.5.1 Restrict Core Dumps (Scored)
  - id: 5531 
    title: "Ensure core dumps are restricted"
    description: "A core dump is the memory of an executable program. It is generally used to determine why a program aborted. It can also be used to glean confidential information from a core file."
    rationale: "Setting a hard limit on core dumps prevents users from overriding the soft variable. If core dumps are required, consider setting limits for user groups (see limits.conf). In addition, setting the fs.suid_dumpable variable to 0 will prevent setuid programs from dumping core."
    remediation: "Add the following line to /etc/security/limits.conf or a /etc/security/limits.d/* file: * hard core 0. Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: fs.suid_dumpable = 0 and set the active kernel parameter"
    compliance:
      - cis: ["1.5.1"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:grep -Rh ^*[[:space:]]*hard[[:space:]][[:space:]]*core[[:space:]][[:space:]]* /etc/security/limits.conf /etc/security/limits.d -> r:\s*\t*0$'
      - 'c:sysctl fs.suid_dumpable -> r:^fs.suid_dumpable\s*=\s*0\s*$'
      - 'c:grep -Rh fs\.suid_dumpable /etc/sysctl.conf /etc/sysctl.d -> r:^\s*fs.suid_dumpable\s*=\s*0\s*$'

# 1.5.2 XD/NX enabled
  - id: 5532 
    title: "Ensure XD/NX support is enabled"
    description: "Recent processors in the x86 family support the ability to prevent code execution on a per memory page basis. Generically and on AMD processors, this ability is called No Execute (NX), while on Intel processors it is called Execute Disable (XD). This ability can help prevent exploitation of buffer overflow vulnerabilities and should be activated whenever possible. Extra steps must be taken to ensure that this protection is enabled, particularly on 32-bit x86 systems. Other processors, such as Itanium and POWER, have included such support since inception and the standard kernel for those platforms supports the feature."
    rationale: "Enabling any feature that can protect against buffer overflow attacks enhances the security of the system."
    remediation: "On 32 bit systems install a kernel with PAE support, no installation is required on 64 bit systems: If necessary configure your bootloader to load the new kernel and reboot the system. You may need to enable NX or XD support in your bios."
    compliance:
      - cis: ["1.5.2"]
      - cis_csc: ["8.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:dmesg -> r:NX \(Execute Disable\) protection: active'

# 1.5.3 Enable Randomized Virtual Memory Region Placement (Scored)
  - id: 5533 
    title: "Ensure address space layout randomization (ASLR) is enabled"
    description: "Address space layout randomization (ASLR) is an exploit mitigation technique which randomly arranges the address space of key data areas of a process."
    rationale: "Randomly placing virtual memory regions will make it difficult to write memory page exploits as the memory placement will be consistently shifting."
    remediation: "Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: kernel.randomize_va_space = 2 and set the active kernel parameter"
    compliance:
      - cis: ["1.5.3"]
      - cis_csc: ["8.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:grep -Rh ^kernel\.randomize_va_space /etc/sysctl.conf /etc/sysctl.d -> r:^\s*kernel.randomize_va_space\s*=\s*2$'
      - 'c:sysctl kernel.randomize_va_space -> r:^\s*kernel.randomize_va_space\s*=\s*2'

# 1.5.4 Disable prelink
  - id: 5534 
    title: "Ensure prelink is disabled"
    description: "prelink is a program that modifies ELF shared libraries and ELF dynamically linked binaries in such a way that the time needed for the dynamic linker to perform relocations at startup significantly decreases."
    rationale: "The prelinking feature can interfere with the operation of AIDE, because it changes binaries. Prelinking can also increase the vulnerability of the system if a malicious user is able to compromise a common library such as libc."
    remediation: "Run the following commands to restore binaries to normal and uninstall prelink: prelink -ua && yum remove prelink"
    compliance:
      - cis: ["1.5.4"]
      - cis_csc: ["3.5"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:rpm -q prelink -> package prelink is not installed'



###############################################
# 1.6 Configure SELinux
###############################################
# 1.6.1.1 SELinux not disabled
  - id: 5535 
    title: "Ensure SELinux is not disabled in bootloader configuration"
    description: "Configure SELINUX to be enabled at boot time and verify that it has not been overwritten by the grub boot parameters."
    rationale: "SELinux must be enabled at boot time in your grub configuration to ensure that the controls it provides are not overridden."
    remediation: "Edit /etc/default/grub and remove all instances of selinux=0 and enforcing=0 from all CMDLINE_LINUX parameters: GRUB_CMDLINE_LINUX_DEFAULT=\"quiet\" GRUB_CMDLINE_LINUX=\"\"  || Run the following command to update the grub2 configuration: grub2-mkconfig -o /boot/grub2/grub.cfg"
    compliance:
      - cis: ["1.6.1.1"]
      - cis_csc: ["14.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'f:/boot/grub2/grub.cfg -> r:linux\.*selinux=0|linux\.*enforcing=0'
# 1.6.1.2 Set selinux state
  - id: 5536 
    title: "Ensure the SELinux state is enforcing"
    description: "Set SELinux to enable when the system is booted."
    rationale: "SELinux must be enabled at boot time in to ensure that the controls it provides are in effect at all times."
    remediation: "Edit the /etc/selinux/config file to set the SELINUX parameter: SELINUX=enforcing"
    compliance:
      - cis: ["1.6.1.2"]
      - cis_csc: ["14.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:sestatus -> r:^SELinux status:\s+enabled$'
      - 'c:sestatus -> r:^Current mode:\s+enforcing$'
      - 'c:sestatus -> r:^Mode from config file:\s+enforcing$'
      - 'f:/etc/selinux/config -> r:^\s*SELINUX\s*=\s*enforcing'

# 1.6.1.3 Set selinux policy
  - id: 5537 
    title: "Ensure SELinux policy is configured"
    description: "Configure SELinux to meet or exceed the default targeted policy, which constrains daemons and system software only."
    rationale: "Security configuration requirements vary from site to site. Some sites may mandate a policy that is stricter than the default policy, which is perfectly acceptable. This item is intended to ensure that at least the default recommendations are met."
    remediation: "Edit the /etc/selinux/config file to set the SELINUXTYPE parameter: SELINUXTYPE=targeted"
    compliance:
      - cis: ["1.6.1.3"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:sestatus -> r:^Loaded policy name:\s+targeted$'
      - 'f:/etc/selinux/config -> r:^\s*SELINUXTYPE\s*=\s*targeted|^\s*SELINUXTYPE\s*=\s*mls'

# 1.6.1.4 Remove SETroubleshoot
  - id: 5538 
    title: "Ensure SETroubleshoot is not installed"
    description: "The SETroubleshoot service notifies desktop users of SELinux denials through a user-friendly interface. The service provides important information around configuration errors, unauthorized intrusions, and other potential errors."
    rationale: "The SETroubleshoot service is an unnecessary daemon to have running on a server, especially if X Windows is disabled."
    remediation: "Run the following command to uninstall s etroubleshoot: # yum remove setroubleshoot"
    compliance:
      - cis: ["1.6.1.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:rpm -qa setroubleshoot -> r:setroubleshoot'

# 1.6.1.5 Disable MCS Translation service mcstrans
  - id: 5539 
    title: "Ensure the MCS Translation Service (mcstrans) is not installed"
    description: "The mcstransd daemon provides category label information to client processes requesting information. The label translations are defined in /etc/selinux/targeted/setrans.conf"
    rationale: "Since this service is not used very often, remove it to reduce the amount of potentially vulnerable code running on the system."
    remediation: "Run the following command to uninstall mcstrans: # yum remove mcstrans"
    compliance:
      - cis: ["1.6.1.5"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:rpm -qa mcstrans -> r:mcstrans'

# 1.6.1.6 Ensure no unconfined daemons exist
  - id: 5540 
    title: "Ensure no unconfined daemons exist"
    description: "Daemons that are not defined in SELinux policy will inherit the security context of their parent process."
    rationale: "Since daemons are launched and descend from the init process, they will inherit the security context label initrc_t . This could cause the unintended consequence of giving the process more permission than it requires."
    remediation: "Investigate any unconfined daemons found during the audit action. They may need to have an existing security context assigned to them or a policy built for them."
    compliance:
      - cis: ["1.6.1.6"]
      - cis_csc: ["14.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:ps -eZ -> r:initrc && !r:tr|ps|egrep|bash|awk'
# 1.6.2 Install SELinux
  - id: 5541 
    title: "Ensure SELinux is installed"
    description: "SELinux provides Mandatory Access Controls."
    rationale: "Without a Mandatory Access Control system installed only the default Discretionary Access Control system will be available."
    remediation: "Run the following command to install libselinux: yum install libselinux"
    compliance:
      - cis: ["1.6.2"]
      - cis_csc: ["14.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:rpm -q libselinux -> r:libselinux-\S+'



###############################################
# 1.7  Warning Banners
###############################################
# 1.7.1.1 Configure message of the day (Scored)
  - id: 5542 
    title: "Ensure message of the day is configured properly"
    description: "The contents of the /etc/motd file are displayed to users after login and function as a message of the day for authenticated users. Unix-based systems have typically displayed information about the OS release and patch level upon logging in to the system. This information can be useful to developers who are developing software for a particular OS platform. If mingetty(8) supports the following options, they display operating system information: \\m - machine architecture \\r - operating system release \\s - operating system name \\v - operating system version"
    rationale: "Warning messages inform users who are attempting to login to the system of their legal status regarding the system and must include the name of the organization that owns the system and any monitoring policies that are in place. Displaying OS and patch level information in login banners also has the side effect of providing detailed system information to attackers attempting to target specific exploits of a system. Authorized users can easily get this information by running the \" uname -a \" command once they have logged in."
    remediation: "Edit the /etc/motd file with the appropriate contents according to your site policy, remove any instances of \\m , \\r , \\s , or \\v."
    compliance:
      - cis: ["1.7.1.1"]
      - pci_dss: ["7.1"]
    condition: none
    rules:
      - 'f:/etc/motd -> r:\\v|\\r|\\m|\\s'

# 1.7.1.2 Configure local login warning banner (Not Scored)
  - id: 5543 
    title: "Ensure local login warning banner is configured properly"
    description: "The contents of the /etc/issue file are displayed to users prior to login for local terminals. Unix-based systems have typically displayed information about the OS release and patch level upon logging in to the system. This information can be useful to developers who are developing software for a particular OS platform. If mingetty(8) supports the following options, they display operating system information: \\m - machine architecture \\r - operating system release \\s - operating system name \\v - operating system version"
    rationale: "Warning messages inform users who are attempting to login to the system of their legal status regarding the system and must include the name of the organization that owns the system and any monitoring policies that are in place. Displaying OS and patch level information in login banners also has the side effect of providing detailed system information to attackers attempting to target specific exploits of a system. Authorized users can easily get this information by running the \" uname -a \" command once they have logged in."
    remediation: "Edit the /etc/issue file with the appropriate contents according to your site policy, remove any instances of \\m , \\r , \\s , or \\v: # echo \"Authorized uses only. All activity may be monitored and reported.\" > /etc/issue"
    compliance:
      - cis: ["1.7.1.2"]
      - pci_dss: ["7.1"]
    condition: none
    rules:
      - 'f:/etc/issue -> r:\\v|\\r|\\m|\\s'

# 1.7.1.3 Configure remote login warning banner (Not Scored)
  - id: 5544 
    title: "Ensure remote login warning banner is configured properly"
    description: "The contents of the /etc/issue.net file are displayed to users prior to login for remote connections from configured services. Unix-based systems have typically displayed information about the OS release and patch level upon logging in to the system. This information can be useful to developers who are developing software for a particular OS platform. If mingetty(8) supports the following options, they display operating system information: \\m - machine architecture \\r - operating system release \\s - operating system name \\v - operating system version"
    rationale: "Warning messages inform users who are attempting to login to the system of their legal status regarding the system and must include the name of the organization that owns the system and any monitoring policies that are in place. Displaying OS and patch level information in login banners also has the side effect of providing detailed system information to attackers attempting to target specific exploits of a system. Authorized users can easily get this information by running the \" uname -a \" command once they have logged in."
    remediation: "Edit the /etc/issue.net file with the appropriate contents according to your site policy, remove any instances of \\m , \\r , \\s , or \\v: # echo \"Authorized uses only. All activity may be monitored and reported.\" > /etc/issue.net"
    compliance:
      - cis: ["1.7.1.3"]
      - pci_dss: ["7.1"]
    condition: none
    rules:
      - 'f:/etc/issue.net -> r:\\v|\\r|\\m|\\s'

# 1.7.1.4 Configure /etc/motd permissions (Not Scored)
  - id: 5545 
    title: "Ensure permissions on /etc/motd are configured"
    description: "The contents of the /etc/motd file are displayed to users after login and function as a message of the day for authenticated users."
    rationale: "If the /etc/motd file does not have the correct ownership it could be modified by unauthorized users with incorrect or misleading information."
    remediation: "Run the following commands to set permissions on /etc/motd: # chown root:root /etc/motd # chmod 644 /etc/motd"
    compliance:
      - cis: ["1.7.1.4"]
      - cis_csc: ["5.1"]
      - pci_dss: ["10.2.5"]
      - hipaa: ["164.312.b"]
      - nist_800_53: ["AU.14", "AC.7"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["35.7","32.2"]
    condition: all
    rules:
      - 'c:stat /etc/motd -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

# 1.7.1.5 Configure /etc/issue permissions (Scored)
  - id: 5546 
    title: "Ensure permissions on /etc/issue are configured"
    description: "The contents of the /etc/issue file are displayed to users prior to login for local terminals."
    rationale: "If the /etc/issue file does not have the correct ownership it could be modified by unauthorized users with incorrect or misleading information."
    remediation: "Run the following commands to set permissions on /etc/issue: # chown root:root /etc/issue # chmod 644 /etc/issue"
    compliance:
      - cis: ["1.7.1.5"]
      - cis_csc: ["5.1"]
      - pci_dss: ["10.2.5"]
      - hipaa: ["164.312.b"]
      - nist_800_53: ["AU.14", "AC.7"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["35.7","32.2"]
    condition: all
    rules:
      - 'c:stat /etc/issue -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'
# 1.7.1.6 Configure /etc/issue.net permissions (Not Scored)
  - id: 5547 
    title: "Ensure permissions on /etc/issue.net are configured"
    description: "The contents of the /etc/issue.net file are displayed to users prior to login for remote connections from configured services."
    rationale: "If the /etc/issue.net file does not have the correct ownership it could be modified by unauthorized users with incorrect or misleading information."
    remediation: "Run the following commands to set permissions on /etc/issue.net: # chown root:root /etc/issue.net # chmod 644 /etc/issue.net"
    compliance:
      - cis: ["1.7.1.6"]
      - cis_csc: ["5.1"]
      - pci_dss: ["10.2.5"]
      - hipaa: ["164.312.b"]
      - nist_800_53: ["AU.14", "AC.7"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["35.7","32.2"]
    condition: all
    rules:
      - 'c:stat /etc/issue.net -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

# 1.7.2 Ensure GDM login banner is configured (Scored)
  - id: 5548 
    title: "Ensure GDM login banner is configured"
    description: "GDM is the GNOME Display Manager which handles graphical login for GNOME based systems."
    rationale: "Warning messages inform users who are attempting to login to the system of their legal status regarding the system and must include the name of the organization that owns the system and any monitoring policies that are in place."
    remediation: "Create the /etc/dconf/profile/gdm file with the following contents:  user-db:user   system-db:gdm        file-db:/usr/share/gdm/greeter-dconf-defaults     ||  Create or edit the banner-message-enable and banner-message-text options in /etc/dconf/db/gdm.d/01-banner-message :   [org/gnome/login-screen]     banner-message-enable=true      banner-message-text='Authorized uses only. All activity may be monitored and reported.'   ||   Run the following command to update the system databases: dconf update"
    compliance:
      - cis: ["1.7.2"]
      - pci_dss: ["7.1"]
    condition: all
    rules:
      - 'f:/etc/dconf/profile/gdm -> r:user-db:user'
      - 'f:/etc/dconf/profile/gdm -> r:system-db:gdm'
      - 'f:/etc/dconf/profile/gdm -> r:file-db:/usr/share/gdm/greeter-dconf-defaults'
      - 'f:/etc/dconf/db/gdm.d/01-banner-message -> r:banner-message-enable=true'
      - 'f:/etc/dconf/db/gdm.d/01-banner-message -> r:banner-message-text=\.+'


# 1.8 Ensure updates, patches, and additional security software are installed(Scored)
  - id: 5549 
    title: "Ensure updates, patches, and additional security software are installed"
    description: "Periodically patches are released for included software either due to security flaws or to include additional functionality."
    rationale: "Newer patches may contain security enhancements that would not be available through the latest full update. As a result, it is recommended that the latest software patches be used to take advantage of the latest functionality. As with any software installation, organizations need to determine if a given update meets their requirements and verify the compatibility and supportability of any additional software against the update revision that is selected."
    remediation: "Site policy may mandate a testing period before install onto production systems for available updates. The audit and remediation here only cover security updates. Non-security updates can be audited with and comparing against site policy: # yum check-update"
    compliance:
      - cis: ["1.8"]
      - cis_csc: ["4.5"]
      - pci_dss: ["5.2"]
      - nist_800_53: ["AU.6","SI.4"]
      - gpg_13: ["4.2"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - 'c:yum check-update --security -> r:No packages needed for security'




###############################################
# 2 OS Services
###############################################
###############################################
# 2.1 inetd Services
###############################################
# 2.1.1 Disable chargen services (Scored)
  - id: 5550 
    title: "Ensure chargen services are not enabled"
    description: "chargen is a network service that responds with 0 to 512 ASCII characters for each connection it receives. This service is intended for debugging and testing purposes. It is recommended that this service be disabled."
    rationale: "Disabling this service will reduce the remote attack surface of the system."
    remediation: "Run the following commands to disable chargen-dgram and chargen-stream: # chkconfig chargen-dgram off; # chkconfig chargen-stream off"
    compliance:
      - cis: ["2.1.1"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*chargen-dgram:\s*\t*on'
      - 'c:chkconfig --list -> r:^\s*\t*chargen-stream:\s*\t*on'

# 2.1.2 Disable daytime services (Scored)
  - id: 5551 
    title: "Ensure daytime services are not enabled"
    description: "daytime is a network service that responds with the server's current date and time. This service is intended for debugging and testing purposes. It is recommended that this service be disabled."
    rationale: "Disabling this service will reduce the remote attack surface of the system."
    remediation: "Run the following commands to disable daytime-dgram and daytime-stream: # chkconfig daytime-dgram off; # chkconfig daytime-stream off"
    compliance:
      - cis: ["2.1.2"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*daytime-dgram:\s*\t*on'
      - 'c:chkconfig --list -> r:^\s*\t*daytime-stream:\s*\t*on'

# 2.1.3 Disable discard services (Scored)
  - id: 5552 
    title: "Ensure discard services are not enabled"
    description: "discardis a network service that simply discards all data it receives. This service is intended for debugging and testing purposes. It is recommended that this service be disabled."
    rationale: "Disabling this service will reduce the remote attack surface of the system."
    remediation: "Run the following commands to disable discard-dgram and discard-stream: # chkconfig discard-dgram off; # chkconfig discard-stream off"
    compliance:
      - cis: ["2.1.3"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*discard-dgram:\s*\t*on'
      - 'c:chkconfig --list -> r:^\s*\t*discard-stream:\s*\t*on'

# 2.1.4 Disable echo-dgram (Scored)
  - id: 5553 
    title: "Ensure echo services are not enabled"
    description: "echo is a network service that responds to clients with the data sent to it by the client. This service is intended for debugging and testing purposes. It is recommended that this service be disabled."
    rationale: "Disabling this service will reduce the remote attack surface of the system."
    remediation: "Run the following commands to disable echo-dgram and echo-stream: # chkconfig echo-dgram off; # chkconfig echo-stream off"
    compliance:
      - cis: ["2.1.4"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*echo-dgram:\s*\t*on'
      - 'c:chkconfig --list -> r:^\s*\t*echo-stream:\s*\t*on'

# 2.1.5 Disable time-stream (Scored)
  - id: 5554 
    title: "Ensure time services are not enabled"
    description: "time is a network service that responds with the server's current date and time as a 32 bit integer. This service is intended for debugging and testing purposes. It is recommended that this service be disabled."
    rationale: "Disabling this service will reduce the remote attack surface of the system."
    remediation: "Run the following commands to disable time-dgram and time-stream: # chkconfig time-dgram off; # chkconfig time-stream off"
    compliance:
      - cis: ["2.1.5"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*time-dgram:\s*\t*on'
      - 'c:chkconfig --list -> r:^\s*\t*time-stream:\s*\t*on'

# 2.1.6 Remove rsh-server (Scored)
  - id: 5575 
    title: "Ensure rsh server is not enabled"
    description: "The Berkeley rsh-server ( rsh , rlogin , rexec ) package contains legacy services that exchange credentials in clear-text."
    rationale: "These legacy services contain numerous security exposures and have been replaced with the more secure SSH package."
    remediation: "Run the following commands to disable rsh, rlogin, and rexec: # chkconfig rsh.socket off   # chkconfig rlogin.socket off  # chkconfig rexec.socket off"
    compliance:
      - cis: ["2.1.6"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*rexec:\s*\t*on'
      - 'c:chkconfig --list -> r:^\s*\t*rlogin:\s*\t*on'
      - 'c:chkconfig --list -> r:^\s*\t*rsh:\s*\t*on'


# 2.1.7 Remove talk server (Scored)
  - id: 5576 
    title: "Ensure talk server is not enabled"
    description: "The talk software makes it possible for users to send and receive messages across systems through a terminal session. The talk client (allows initiate of talk sessions) is installed by default."
    rationale: "The software presents a security risk as it uses unencrypted protocols for communication."
    remediation: "Run the following command to disable talk: # chkconfig ntalk off"
    compliance:
      - cis: ["2.1.7"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*talk:\s*\t*on'

# 2.1.8 Remove telnet-server (Scored)
  - id: 5577 
    title: "Ensure telnet server is not enabled"
    description: "The telnet-server package contains the telnet daemon, which accepts connections from users from other systems via the telnet protocol."
    rationale: "The telnet protocol is insecure and unencrypted. The use of an unencrypted transmission medium could allow a user with access to sniff network traffic the ability to steal credentials. The ssh package provides an encrypted session and stronger security."
    remediation: "Run the following command to disable telnet: # chkconfig telnet.socket off"
    compliance:
      - cis: ["2.1.8"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*telnet:\s*\t*on'

# 2.1.9 Ensure tftp server is not enabled (Scored)
  - id: 5555 
    title: "Ensure tftp server is not enabled"
    description: "Trivial File Transfer Protocol (TFTP) is a simple file transfer protocol, typically used to automatically transfer configuration or boot machines from a boot server. The package tftp-server is used to define and support a TFTP server."
    rationale: "TFTP does not support authentication nor does it ensure the confidentiality or integrity of data. It is recommended that TFTP be removed, unless there is a specific need for TFTP. In that case, extreme caution must be used when configuring the services."
    remediation: "Run the following command to disable tftp: # chkconfig tftp off"
    compliance:
      - cis: ["2.1.9"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1","AC.4","SC.7"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*tftp:\s*\t*on'

# 2.1.10 Remove rsync service (Scored)
  - id: 5579 
    title: "Ensure rsync service is not enabled"
    description: "The rsyncd service can be used to synchronize files between systems over network links."
    rationale: "The rsyncd service presents a security risk as it uses unencrypted protocols for communication."
    remediation: "Run the following command to disable rsync: # chkconfig rsyncd off"
    compliance:
      - cis: ["2.1.10"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*rsync:\s*\t*on'

# 2.1.11 Remove xinetd (Scored)
  - id: 5556 
    title: "Ensure xinetd is not enabled"
    description: "The eXtended InterNET Daemon ( xinetd ) is an open source super daemon that replaced the original inetd daemon. The xinetd daemon listens for well known services and dispatches the appropriate daemon to properly respond to service requests."
    rationale: "If there are no xinetd services required, it is recommended that the daemon be disabled."
    remediation: "Run the following command to disable xinetd: # chkconfig xinetd off"
    compliance:
      - cis: ["2.1.11"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*xinetd\.*on'


###############################################
# 2.2 Remove Legacy Services
###############################################

# 2.2.1.1 Ensure time synchronization is in use (Not Scored)
  - id: 5557 
    title: "Ensure time synchronization is in use"
    description: "System time should be synchronized between all systems in an environment. This is typically done by establishing an authoritative time server or set of servers and having all systems synchronize their clocks to them."
    rationale: "Time synchronization is important to support time sensitive security mechanisms like Kerberos and also ensures log files have consistent time records across the enterprise, which aids in forensic investigations."
    remediation: "On physical systems or virtual systems where host based time synchronization is not available run the following commands and verify either ntp or chrony is installed: # rpm -q ntp # rpm -q chrony  On virtual systems where host based time synchronization is available consult your virtualization software documentation and verify that host based synchronization is in use."
    compliance:
      - cis: ["2.2.2.1"]
      - cis_csc: ["6.1"]
      - pci_dss: ["10.4"]
      - nist_800_53: ["AU.8"]
    condition: any
    rules:
      - 'not c:rpm -q ntp -> r:^package ntp is not installed'
      - 'not c:rpm -q chrony -> r:^package chrony is not installed'

# 2.2.1.2 Configure Network Time Protocol (NTP) (Scored)
  - id: 5558 
    title: "Ensure ntp is configured"
    description: "ntp is a daemon which implements the Network Time Protocol (NTP). It is designed to synchronize system clocks across a variety of systems and use a source that is highly accurate. More information on NTP can be found at https://www.ntp.org. ntp can be configured to be a client and/or a server."
    rationale: "If ntp is in use on the system proper configuration is vital to ensuring time synchronization is working properly."
    remediation: "1) Add or edit restrict lines in /etc/ntp.conf to match the following: - restrict -4 default kod nomodify notrap nopeer noquery and - restrict -4 default kod nomodify notrap nopeer noquery. 2) Add or edit server or pool lines to /etc/ntp.conf as appropriate: server <remote-server>. 3) Add or edit the OPTIONS in /etc/sysconfig/ntpd to include ' -u ntp:ntp ': - OPTIONS='-u ntp:ntp'"
    compliance:
      - cis: ["2.2.1.2"]
      - cis_csc: ["6.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'f:/etc/ntp.conf -> r:^restrict\s+-4\s+default|^restrict\s+default && r:\s+kod\s+ && r:\s+nomodify\s+ && r:\s+notrap\s+ && r:\s+nopeer\s+ && r:\s+noquery'
      - 'f:/etc/ntp.conf -> r:^restrict\s+-6\s+default && r:\s+kod\s+ && r:\s+nomodify\s+ && r:\s+notrap\s+ && r:\s+nopeer\s+ && r:\s+noquery'
      - 'f:/etc/ntp.conf -> r:^server\.+$|^pool\.+$'
      - 'f:/etc/sysconfig/ntpd -> r:^OPTIONS\s*=\s* && r:-u ntp:ntp'
      - 'f:/usr/lib/systemd/system/ntpd.service -> r:^Execstart\s*=\s*/usr/sbin/ntpd\s+-u\s+ntp:ntp'

# 2.2.1.3 Configure Network Time Protocol (Chrony) (Scored)
  - id: 5559 
    title: "Ensure chrony is configured"
    description: "chrony is a daemon which implements the Network Time Protocol (NTP). It is designed to synchronize system clocks across a variety of systems and use a source that is highly accurate. More information on NTP can be found at https://www.ntp.org. ntp can be configured to be a client and/or a server."
    rationale: "If chrony is in use on the system proper configuration is vital to ensuring time synchronization is working properly."
    remediation: "1) Add or edit restrict lines in /etc/chrony.conf to match the following: - 1) Add or edit server or pool lines to /etc/chrony.conf as appropriate: server <remote-server>. 3) Add or edit the OPTIONS in /etc/sysconfig/chronyd to include: - OPTIONS='-u chronyd'"
    compliance:
      - cis: ["2.2.1.3"]
      - cis_csc: ["6.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'f:/etc/chrony.conf -> r:^server\.+$|^pool\.+$'
      - 'f:/etc/sysconfig/chronyd -> r:^OPTIONS\s*=\s* && r:-u chrony'

# 2.2.2 Remove X Windows (Scored)
  - id: 5560 
    title: "Ensure X Window System is not installed"
    description: "The X Window System provides a Graphical User Interface (GUI) where users can have multiple windows in which to run programs and various add on. The X Windows system is typically used on workstations where users login, but not on servers where users typically do not login."
    rationale: "Unless your organization specifically requires graphical login access via X Windows, remove it to reduce the potential attack surface."
    remediation: "Run the following command to remove the X Windows System packages: # yum remove xorg-x11*"
    compliance:
      - cis: ["2.2.2"]
      - cis_csc: ["2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:rpm -qa xorg-x11* -> r:^xorg-x11'

# 2.2.3 Disable Avahi Server (Scored)
  - id: 5561 
    title: "Ensure Avahi Server is not enabled"
    description: "Avahi is a free zeroconf implementation, including a system for multicast DNS/DNS-SD service discovery. Avahi allows programs to publish and discover services and hosts running on a local network with no specific configuration. For example, a user can plug a computer into a network and Avahi automatically finds printers to print to, files to look at and people to talk to, as well as network services running on the machine."
    rationale: "Automatic discovery of network services is not normally required for system functionality. It is recommended to disable the service to reduce the potential attack surface."
    remediation: "Run the following command to disable avahi-daemon: # chkconfig avahi-daemon off"
    compliance:
      - cis: ["2.2.3"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*avahi-daemon\.*on'

# 2.2.4 Ensure CUPS is not enabled (Scored)
  - id: 5562 
    title: "Ensure CUPS is not enabled"
    description: "The Common Unix Print System (CUPS) provides the ability to print to both local and network printers. A system running CUPS can also accept print jobs from remote systems and print them to local printers. It also provides a web based remote administration capability."
    rationale: "If the system does not need to print jobs or accept print jobs from other systems, it is recommended that CUPS be disabled to reduce the potential attack surface."
    remediation: "Run the following command to disable cups : # chkconfig cups off"
    compliance:
      - cis: ["2.2.4"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*cups\.*on'

# 2.2.5 Remove DHCP Server (Scored)
  - id: 5563 
    title: "Ensure DHCP Server is not enabled"
    description: "The Dynamic Host Configuration Protocol (DHCP) is a service that allows machines to be dynamically assigned IP addresses."
    rationale: "Unless a system is specifically set up to act as a DHCP server, it is recommended that this service be disabled to reduce the potential attack surface."
    remediation: "Run the following command to disable dhcpd: # chkconfig dhcpd off"
    compliance:
      - cis: ["2.2.5"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    references:
      - More detailed documentation on DHCP is available at https://www.isc.org/software/dhcp
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*dhcpd\.*on'

# 2.2.6 Remove LDAP Server (Scored)
  - id: 5564 
    title: "Ensure LDAP Server is not enabled"
    description: "The Lightweight Directory Access Protocol (LDAP) was introduced as a replacement for NIS/YP. It is a service that provides a method for looking up information from a central database."
    rationale: "If the system will not need to act as an LDAP server, it is recommended that the software be disabled to reduce the potential attack surface."
    remediation: "Run the following command to disable slapd: # chkconfig slapd off"
    compliance:
      - cis: ["2.2.6"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    references:
      - More detailed documentation on OpenLDAP is available at https://www.openldap.org
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*slapd\.*on'



# 2.2.7 Disable NFS and RPC (Scored)
  - id: 5565 
    title: "Ensure NFS and RPC are not enabled"
    description: "The Network File System (NFS) is one of the first and most widely distributed file systems in the UNIX environment. It provides the ability for systems to mount file systems of other servers through the network."
    rationale: "If the system does not export NFS shares or act as an NFS client, it is recommended that these services be disabled to reduce remote attack surface."
    remediation: "Run the following commands to disable nfs, nfs-server and rpcbind: # chkconfig nfs off; # chkconfig nfs-server; off # chkconfig rpcbind off"
    compliance:
      - cis: ["2.2.7"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*nfs\.*on'
      - 'c:chkconfig --list -> r:^\s*\t*rpcbind\.*on'

# 2.2.8 Ensure DNS Server is not enabled (Scored)
  - id: 5566 
    title: "Ensure DNS Server is not enabled"
    description: "The Domain Name System (DNS) is a hierarchical naming system that maps names to IP addresses for computers, services and other resources connected to a network."
    rationale: "Unless a system is specifically designated to act as a DNS server, it is recommended that the service be disabled to reduce the potential attack surface."
    remediation: "Run the following command to disable named : # chkconfig named off"
    compliance:
      - cis: ["2.2.8"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*named\.*on'

# 2.2.9 Remove FTP Server (Scored)
  - id: 5567 
    title: "Ensure FTP Server is not enabled"
    description: "The File Transfer Protocol (FTP) provides networked computers with the ability to transfer files."
    rationale: "FTP does not protect the confidentiality of data or authentication credentials. It is recommended sftp be used if file transfer is required. Unless there is a need to run the system as a FTP server (for example, to allow anonymous downloads), it is recommended that the service be disabled to reduce the potential attack surface."
    remediation: "Run the following command to disable vsftpd: # chkconfig vsftpd off"
    compliance:
      - cis: ["2.2.9"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*vsftpd\.*on'

# 2.2.10 Remove HTTP Server (Scored)
  - id: 5568 
    title: "Ensure HTTP server is not enabled"
    description: "HTTP or web servers provide the ability to host web site content."
    rationale: "Unless there is a need to run the system as a web server, it is recommended that the service be disabled to reduce the potential attack surface."
    remediation: "Run the following command to disable httpd: # chkconfig httpd off"
    compliance:
      - cis: ["2.2.10"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*httpd\.*on'

# 2.2.11 Remove Dovecot (IMAP and POP3 services) (Scored)
  - id: 5569 
    title: "Ensure IMAP and POP3 server is not enabled"
    description: "dovecot is an open source IMAP and POP3 server for Linux based systems."
    rationale: "Unless POP3 and/or IMAP servers are to be provided by this system, it is recommended that the service be disabled to reduce the potential attack surface."
    remediation: "Run the following command to disable dovecot: # chkconfig dovecot off"
    compliance:
      - cis: ["2.2.11"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*dovecot\.*on'

# 2.2.12 Remove Samba (Scored)
  - id: 5570 
    title: "Ensure Samba is not enabled"
    description: "The Samba daemon allows system administrators to configure their Linux systems to share file systems and directories with Windows desktops. Samba will advertise the file systems and directories via the Small Message Block (SMB) protocol. Windows desktop users will be able to mount these directories and file systems as letter drives on their systems."
    rationale: "If there is no need to mount directories and file systems to Windows systems, then this service can be disabled to reduce the potential attack surface."
    remediation: "Run the following command to disable smb: # chkconfig smb off"
    compliance:
      - cis: ["2.2.12"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*smb\.*on'

# 2.2.13 Remove HTTP Proxy Server (Scored)
  - id: 5571 
    title: "Ensure HTTP Proxy Server is not enabled"
    description: "Squid is a standard proxy server used in many distributions and environments."
    rationale: "If there is no need for a proxy server, it is recommended that the squid proxy be disabled to reduce the potential attack surface."
    remediation: "Run the following command to disable squid: # chkconfig squid off"
    compliance:
      - cis: ["2.2.13"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*squid\.*on'

# 2.2.14 Remove SNMP Server (Not Scored)
  - id: 5572 
    title: "Ensure SNMP Server is not enabled"
    description: "The Simple Network Management Protocol (SNMP) server is used to listen for SNMP commands from an SNMP management system, execute the commands or collect the information and then send results back to the requesting system."
    rationale: "The SNMP server can communicate using SNMP v1, which transmits data in the clear and does not require authentication to execute commands. Unless absolutely necessary, it is recommended that the SNMP service not be used. If SNMP is required the server should be configured to disallow SNMP v1."
    remediation: "Run the following command to disable snmpd: # chkconfig snmpd off"
    compliance:
      - cis: ["2.2.14"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*snmpd\.*on'

# 2.2.15 Ensure mail transfer agent is configured for local-only mode (Scored)
  - id: 5573 
    title: "Ensure mail transfer agent is configured for local-only mode"
    description: "Mail Transfer Agents (MTA), such as sendmail and Postfix, are used to listen for incoming mail and transfer the messages to the appropriate user or mail server. If the system is not intended to be a mail server, it is recommended that the MTA be configured to only process local mail."
    rationale: "Mail Transfer Agents (MTA), such as sendmail and Postfix, are used to listen for incoming mail and transfer the messages to the appropriate user or mail server. If the system is not intended to be a mail server, it is recommended that the MTA be configured to only process local mail."
    remediation: "Edit /etc/postfix/main.cf and add the following line to the RECEIVING MAIL section. If the line already exists, change it to look like the line below: inet_interfaces = loopback-only . Restart postfix: # systemctl restart postfix"
    compliance:
      - cis: ["2.2.15"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1","AC.4","SC.7"]
    condition: none
    rules:
      - 'c:netstat -an -> r:\.*:25\.*LISTEN && !r:127.0.0.1:25\.+LISTEN|::1:25\.*LISTEN'

# 2.2.16 Remove NIS Server (Scored)
  - id: 5574 
    title: "Ensure NIS Server is not enabled"
    description: "The Network Information Service (NIS) (formally known as Yellow Pages) is a client-server directory service protocol for distributing system configuration files. The NIS server is a collection of programs that allow for the distribution of configuration files."
    rationale: "The NIS service is inherently an insecure system that has been vulnerable to DOS attacks, buffer overflows and has poor authentication for querying NIS maps. NIS generally been replaced by such protocols as Lightweight Directory Access Protocol (LDAP). It is recommended that the service be disabled and other, more secure services be used"
    remediation: "Run the following command to disable ypserv: # chkconfig ypserv off"
    compliance:
      - cis: ["2.2.16"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'c:chkconfig --list -> r:^\s*\t*ypserv\.*on'


###############################################
# 2.3 Service Clients
###############################################
# 2.3.1 Remove NIS Client (Scored)
  - id: 5580 
    title: "Ensure NIS Client is not installed"
    description: "The Network Information Service (NIS), formerly known as Yellow Pages, is a client-server directory service protocol used to distribute system configuration files. The NIS client ( ypbind ) was used to bind a machine to an NIS server and receive the distributed configuration files."
    rationale: "The NIS service is inherently an insecure system that has been vulnerable to DOS attacks, buffer overflows and has poor authentication for querying NIS maps. NIS generally has been replaced by such protocols as Lightweight Directory Access Protocol (LDAP). It is recommended that the service be removed."
    remediation: "Run the following command to uninstall ypbind: # yum remove ypbind"
    compliance:
      - cis: ["2.3.1"]
      - cis_csc: ["2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'c:rpm -qa ypbind -> r:ypbind'

# 2.3.2 Ensure rsh client is not installed (Scored)
  - id: 5581 
    title: "Ensure rsh client is not installed"
    description: "The rsh package contains the client commands for the rsh services."
    rationale: "These legacy clients contain numerous security exposures and have been replaced with the more secure SSH package. Even if the server is removed, it is best to ensure the clients are also removed to prevent users from inadvertently attempting to use these commands and therefore exposing their credentials. Note that removing the rsh package removes the clients for rsh , rcp and rlogin ."
    remediation: "Run the following command to uninstall rsh : # yum remove rsh"
    compliance:
      - cis: ["2.3.2"]
      - cis_csc: ["2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - 'c:rpm -q rsh -> r:^package rsh is not installed'

# 2.3.3 Ensure talk client is not installed (Scored)
  - id: 5582 
    title: "Ensure talk client is not installed"
    description: "The talk software makes it possible for users to send and receive messages across systems through a terminal session. The talk client, which allows initialization of talk sessions, is installed by default."
    rationale: "The software presents a security risk as it uses unencrypted protocols for communication."
    remediation: "Run the following command to uninstall talk : # yum remove talk"
    compliance:
      - cis: ["2.3.3"]
      - cis_csc: ["2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - 'c:rpm -q talk -> r:^package talk is not installed'

# 2.3.4 Ensure telnet client is not installed (Scored)
  - id: 5583 
    title: "Ensure telnet client is not installed"
    description: "The telnet package contains the telnet client, which allows users to start connections to other systems via the telnet protocol."
    rationale: "The telnet protocol is insecure and unencrypted. The use of an unencrypted transmission medium could allow an unauthorized user to steal credentials. The ssh package provides an encrypted session and stronger security and is included in most Linux distributions."
    remediation: "Run the following command to uninstall telnet : # yum remove telnet"
    compliance:
      - cis: ["2.3.4"]
      - cis_csc: ["2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - 'c:rpm -q telnet -> r:^package telnet is not installed'

# 2.3.5 Ensure LDAP client is not installed (Scored)
  - id: 5584 
    title: "Ensure LDAP client is not installed"
    description: "The Lightweight Directory Access Protocol (LDAP) was introduced as a replacement for NIS/YP. It is a service that provides a method for looking up information from a central database."
    rationale: "If the system will not need to act as an LDAP client, it is recommended that the software be removed to reduce the potential attack surface."
    remediation: "Run the following command to uninstall openldap-clients : # yum remove openldap-clients"
    compliance:
      - cis: ["2.3.5"]
      - cis_csc: ["2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - 'c:rpm -q openldap-clients -> r:^package openldap-clients is not installed'



###############################################
# 3 Network Configuration and Firewalls
###############################################
###############################################
# 3.1 Modify Network Parameters (Host Only)
###############################################
# 3.1.1 Disable IP Forwarding (Scored)
  - id: 5585 
    title: "Ensure IP forwarding is disabled"
    description: "The net.ipv4.ip_forward flag is used to tell the system whether it can forward packets or not."
    rationale: "Setting the flag to 0 ensures that a system with multiple interfaces (for example, a hard proxy), will never be able to forward packets, and therefore, never serve as a router."
    remediation: "Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.ip_forward = 0 and set the active kernel parameters."
    compliance:
      - cis: ["3.1.1"]
      - cis_csc: ["3", "11"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.ip_forward -> r:^net.ipv4.ip_forward\s*=\s*0$'
      - 'c:grep -Rh net\.ipv4\.ip_forward /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.ip_forward\s*=\s*0$'

# 3.1.2 Disable Send Packet Redirects (Scored)
  - id: 5586 
    title: "Ensure packet redirect sending is disabled"
    description: "ICMP Redirects are used to send routing information to other hosts. As a host itself does not act as a router (in a host only configuration), there is no need to send redirects."
    rationale: "An attacker could use a compromised host to send invalid ICMP redirects to other router devices in an attempt to corrupt routing and have users access a system set up by the attacker as opposed to a valid system."
    remediation: "Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.conf.all.send_redirects = 0; net.ipv4.conf.default.send_redirects = 0 and set the active kernel parameters. Run the following commands to set the active kernel parameters: # sysctl -w net.ipv4.conf.all.send_redirects=0; # sysctl -w net.ipv4.conf.default.send_redirects=0; # sysctl -w net.ipv4.route.flush=1"
    compliance:
      - cis: ["3.1.2"]
      - cis_csc: ["3", "11"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.send_redirects -> r:^net.ipv4.conf.all.send_redirects\s*=\s*0$'
      - 'c:sysctl net.ipv4.conf.default.send_redirects -> r:^net.ipv4.conf.default.send_redirects\s*=\s*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.all\.send_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.all.send_redirects\s*=\s*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.default\.send_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.default.send_redirects\s*=\s*0$'

###############################################
# 3.2 Modify Network Parameters (Host and Router)
###############################################
# 3.2.1 Disable Source Routed Packet Acceptance (Scored)
  - id: 5587 
    title: "Ensure source routed packets are not accepted"
    description: "In networking, source routing allows a sender to partially or fully specify the route packets take through a network. In contrast, non-source routed packets travel a path determined by routers in the network. In some cases, systems may not be routable or reachable from some locations (e.g. private addresses vs. Internet routable), and so source routed packets would need to be used."
    rationale: "Setting net.ipv4.conf.all.accept_source_route and net.ipv4.conf.default.accept_source_route to 0 disables the system from accepting source routed packets. Assume this system was capable of routing packets to Internet routable addresses on one interface and private addresses on another interface. Assume that the private addresses were not routable to the Internet routable addresses and vice versa. Under normal routing circumstances, an attacker from the Internet routable addresses could not use the system as a way to reach the private address systems. If, however, source routed packets were allowed, they could be used to gain access to the private address systems as the route could be specified, rather than rely on routing protocols that did not allow this routing."
    remediation: "Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.conf.all.accept_source_route = 0; net.ipv4.conf.default.accept_source_route = 0 and set the active kernel parameters."
    compliance:
      - cis: ["3.2.1"]
      - cis_csc: ["3", "11"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.accept_source_route -> r:^net.ipv4.conf.all.accept_source_route\s*=\s*0$'
      - 'c:sysctl net.ipv4.conf.default.accept_source_route -> r:^net.ipv4.conf.default.accept_source_route\s*=\s*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.all\.accept_source_route /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.all.accept_source_route\s*=\s*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.default\.accept_source_route /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.default.accept_source_route\s*=\s*0$'

# 3.2.2 Disable ICMP Redirect Acceptance (Scored)
  - id: 5588 
    title: "Ensure ICMP redirects are not accepted"
    description: "ICMP redirect messages are packets that convey routing information and tell your host (acting as a router) to send packets via an alternate path. It is a way of allowing an outside routing device to update your system routing tables."
    rationale: "Attackers could use bogus ICMP redirect messages to maliciously alter the system routing tables and get them to send packets to incorrect networks and allow your system packets to be captured."
    remediation: "Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.conf.all.accept_redirects = 0; net.ipv4.conf.default.accept_redirects = 0 and set the active kernel parameters."
    compliance:
      - cis: ["3.2.2"]
      - cis_csc: ["3", "11"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.accept_redirects -> r:^net.ipv4.conf.all.accept_redirects\s*=\s*0$'
      - 'c:sysctl net.ipv4.conf.default.accept_redirects -> r:^net.ipv4.conf.default.accept_redirects\s*=\s*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.all\.accept_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.all.accept_redirects\s*=\s*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.default\.accept_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.default.accept_redirects\s*=\s*0$'

# 3.2.3 Disable Secure ICMP Redirect Acceptance (Scored)
  - id: 5589 
    title: "Ensure secure ICMP redirects are not accepted"
    description: "Secure ICMP redirects are the same as ICMP redirects, except they come from gateways listed on the default gateway list. It is assumed that these gateways are known to your system, and that they are likely to be secure."
    rationale: "It is still possible for even known gateways to be compromised. Setting net.ipv4.conf.all.secure_redirects to 0 protects the system from routing table updates by possibly compromised known gateways."
    remediation: "Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.conf.all.secure_redirects = 0; net.ipv4.conf.default.secure_redirects = 0 and set the active kernel parameters."
    compliance:
      - cis: ["3.2.3"]
      - cis_csc: ["3", "11"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.secure_redirects -> r:^net.ipv4.conf.all.secure_redirects\s*=\s*0$'
      - 'c:sysctl net.ipv4.conf.default.secure_redirects -> r:^net.ipv4.conf.default.secure_redirects\s*=\s*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.all\.secure_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.all.secure_redirects\s*=\s*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.default\.secure_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.default.secure_redirects\s*=\s*0$'

# 3.2.4 Log Suspicious Packets (Scored)
  - id: 5590 
    title: "Ensure suspicious packets are logged"
    description: "When enabled, this feature logs packets with un-routable source addresses to the kernel log."
    rationale: "Enabling this feature and logging these packets allows an administrator to investigate the possibility that an attacker is sending spoofed packets to their system."
    remediation: "Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.conf.all.log_martians = 1; net.ipv4.conf.default.log_martians = 1 and set the active kernel parameters."
    compliance:
      - cis: ["3.2.4"]
      - cis_csc: ["6"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.log_martians -> r:^net.ipv4.conf.all.log_martians\s*=\s*1$'
      - 'c:sysctl net.ipv4.conf.default.log_martians -> r:^net.ipv4.conf.default.log_martians\s*=\s*1$'
      - 'c:grep -Rh net\.ipv4\.conf\.all\.log_martians /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.all.log_martians\s*=\s*1$'
      - 'c:grep -Rh net\.ipv4\.conf\.default\.log_martians /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.default.log_martians\s*=\s*1$'

# 3.2.5 Enable Ignore Broadcast Requests (Scored)
  - id: 5591 
    title: "Ensure broadcast ICMP requests are ignored"
    description: "Setting net.ipv4.icmp_echo_ignore_broadcasts to 1 will cause the system to ignore all ICMP echo and timestamp requests to broadcast and multicast addresses."
    rationale: "Accepting ICMP echo and timestamp requests with broadcast or multicast destinations for your network could be used to trick your host into starting (or participating) in a Smurf attack. A Smurf attack relies on an attacker sending large amounts of ICMP broadcast messages with a spoofed source address."
    remediation: "Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.icmp_echo_ignore_broadcasts = 1 and set the active kernel parameters."
    compliance:
      - cis: ["3.2.5"]
      - cis_csc: ["3", "11"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.icmp_echo_ignore_broadcasts -> r:^net.ipv4.icmp_echo_ignore_broadcasts\s*=\s*1$'
      - 'c:grep -Rh net\.ipv4\.icmp_echo_ignore_broadcasts /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.icmp_echo_ignore_broadcasts\s*=\s*1$'

# 3.2.6 Enable Bad Error Message Protection (Scored)
  - id: 5592 
    title: "Ensure bogus ICMP responses are ignored"
    description: "Setting icmp_ignore_bogus_error_responses to 1 prevents the kernel from logging bogus responses (RFC-1122 non-compliant) from broadcast reframes, keeping file systems from filling up with useless log messages."
    rationale: "Some routers (and some attackers) will send responses that violate RFC-1122 and attempt to fill up a log file system with many useless error messages."
    remediation: "Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.icmp_ignore_bogus_error_responses = 1 and set the active kernel parameters."
    compliance:
      - cis: ["3.2.6"]
      - cis_csc: ["3", "11"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.icmp_ignore_bogus_error_responses -> r:^net.ipv4.icmp_ignore_bogus_error_responses\s*=\s*1$'
      - 'c:grep -Rh net\.ipv4\.icmp_ignore_bogus_error_responses /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.icmp_ignore_bogus_error_responses\s*=\s*1$'

# 3.2.7 Enable RFC-recommended Source Route Validation (Scored)
  - id: 5593 
    title: "Ensure Reverse Path Filtering is enabled"
    description: "Setting net.ipv4.conf.all.rp_filter and net.ipv4.conf.default.rp_filter to 1 forces the Linux kernel to utilize reverse path filtering on a received packet to determine if the packet was valid. Essentially, with reverse path filtering, if the return packet does not go out the same interface that the corresponding source packet came from, the packet is dropped (and logged if log_martians is set)."
    rationale: "Setting these flags is a good way to deter attackers from sending your server bogus packets that cannot be responded to. One instance where this feature breaks down is if asymmetrical routing is employed. This would occur when using dynamic routing protocols (bgp, ospf, etc) on your system. If you are using asymmetrical routing on your system, you will not be able to enable this feature without breaking the routing."
    remediation: "Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.conf.all.rp_filter = 1; net.ipv4.conf.default.rp_filter = 1 and set the active kernel parameters."
    compliance:
      - cis: ["3.2.7"]
      - cis_csc: ["3", "11"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.rp_filter -> r:^net.ipv4.conf.all.rp_filter\s*=\s*1$'
      - 'c:sysctl net.ipv4.conf.default.rp_filter -> r:^net.ipv4.conf.default.rp_filter\s*=\s*1$'
      - 'c:grep -Rh net\.ipv4\.conf\.all\.rp_filter /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.all.rp_filter\s*=\s*1$'
      - 'c:grep -Rh net\.ipv4\.conf\.default\.rp_filter /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.default.rp_filter\s*=\s*1$'

# 3.2.8 Enable TCP SYN Cookies (Scored)
  - id: 5594 
    title: "Ensure TCP SYN Cookies is enabled"
    description: "When tcp_syncookies is set, the kernel will handle TCP SYN packets normally until the half-open connection queue is full, at which time, the SYN cookie functionality kicks in. SYN cookies work by not using the SYN queue at all. Instead, the kernel simply replies to the SYN with a SYN|ACK, but will include a specially crafted TCP sequence number that encodes the source and destination IP address and port number and the time the packet was sent."
    rationale: "Attackers use SYN flood attacks to perform a denial of service attacked on a system by sending many SYN packets without completing the three way handshake. This will quickly use up slots in the kernel's half-open connection queue and prevent legitimate connections from succeeding. SYN cookies allow the system to keep accepting valid connections, even if under a denial of service attack."
    remediation: "Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.tcp_syncookies = 1 and set the active kernel parameters."
    compliance:
      - cis: ["3.2.8"]
      - cis_csc: ["3", "11"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.tcp_syncookies -> r:^net.ipv4.tcp_syncookies\s*=\s*1$'
      - 'c:grep -Rh net\.ipv4\.tcp_syncookies /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.tcp_syncookies\s*=\s*1$'

###############################################
# 3.3 IPv6
###############################################
# 3.3.1 Ensure IPv6 router advertisements are not accepted (Not Scored)
  - id: 5595 
    title: "Ensure IPv6 router advertisements are not accepted"
    description: "This setting disables the system's ability to accept IPv6 router advertisements."
    rationale: "It is recommended that systems not accept router advertisements as they could be tricked into routing traffic to compromised machines. Setting hard routes within the system (usually a single default route to a trusted router) protects the system from bad routes."
    remediation: "Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv6.conf.all.accept_ra = 0 and net.ipv6.conf.default.accept_ra = 0 Then, run the following commands to set the active kernel parameters: # sysctl -w net.ipv6.conf.all.accept_ra=0 # sysctl -w net.ipv6.conf.default.accept_ra=0 # sysctl -w net.ipv6.route.flush=1"
    compliance:
      - cis: ["3.3.1"]
      - cis_csc: ["3", "11"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - 'c:sysctl net.ipv6.conf.all.accept_ra -> r:^net.ipv6.conf.all.accept_ra\s*=\s*0$'
      - 'c:sysctl net.ipv6.conf.default.accept_ra -> r:^net.ipv6.conf.default.accept_ra\s*=\s*0$'
      - 'c:grep -Rh net\.ipv6\.conf\.all\.accept_ra /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv6.conf.all.accept_ra\s*=\s*0'
      - 'c:grep -Rh net\.ipv6\.conf\.default\.accept_ra /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv6.conf.default.accept_ra\s*=\s*0'


# 3.3.2 Ensure IPv6 redirects are not accepted (Not Scored)
  - id: 5596 
    title: "Ensure IPv6 redirects are not accepted"
    description: "This setting prevents the system from accepting ICMP redirects. ICMP redirects tell the system about alternate routes for sending traffic."
    rationale: "It is recommended that systems not accept ICMP redirects as they could be tricked into routing traffic to compromised machines. Setting hard routes within the system (usually a single default route to a trusted router) protects the system from bad routes."
    remediation: "Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv6.conf.all.accept_redirects = 0  || net.ipv6.conf.default.accept_redirects = 0 Then, run the following commands to set the active kernel parameters: # sysctl -w net.ipv6.conf.all.accept_redirects=0 # sysctl -w net.ipv6.conf.default.accept_redirects=0 # sysctl -w net.ipv6.route.flush=1"
    compliance:
      - cis: ["3.3.2"]
      - cis_csc: ["3", "11"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - 'c:sysctl net.ipv6.conf.all.accept_redirects -> r:^net.ipv6.conf.all.accept_redirects\s*=\s*0$'
      - 'c:sysctl net.ipv6.conf.default.accept_redirects -> r:^net.ipv6.conf.default.accept_redirects\s*=\s*0$'
      - 'c:grep -Rh net\.ipv6\.conf\.all\.accept_redirect /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv6.conf.all.accept_redirects\s*=\s*0'
      - 'c:grep -Rh net\.ipv6\.conf\.default\.accept_redirect /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv6.conf.default.accept_redirects\s*=\s*0'

# 3.3.3 Ensure IPv6 is disabled (Not Scored)
  - id: 5597 
    title: "Ensure IPv6 is disabled"
    description: "Although IPv6 has many advantages over IPv4, few organizations have implemented IPv6."
    rationale: "If IPv6 is not to be used, it is recommended that it be disabled to reduce the attack surface of the system."
    remediation: "Edit /etc/default/grub and remove add ipv6.disable=1 to the GRUB_CMDLINE_LINUX parameters and update the grub2 configuration."
    compliance:
      - cis: ["3.3.3"]
      - cis_csc: ["3", "11"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - 'f:/boot/grub2/grub.cfg -> r:^\s*\t*linux && !r:ipv6.disable=1'


###############################################
# 3.4 TCP Wrappers
###############################################
# 3.4.1 Ensure TCP Wrappers is installed (Scored)
  - id: 5598 
    title: "Ensure TCP Wrappers is installed"
    description: "TCP Wrappers provides a simple access list and standardized logging method for services capable of supporting it. In the past, services that were called from inetd and xinetd supported the use of tcp wrappers. As inetd and xinetd have been falling in disuse, any service that can support tcp wrappers will have the libwrap.so library attached to it."
    rationale: "TCP Wrappers provide a good simple access list mechanism to services that may not have that support built in. It is recommended that all services that can support TCP Wrappers, use it."
    remediation: "Run the following command to install tcp_wrappers: yum install tcp_wrappers"
    compliance:
      - cis: ["3.4.1"]
      - cis_csc: ["9.2"]
      - pci_dss: ["1.3.5"]
    condition: all
    rules:
      - 'c:rpm -q tcp_wrappers -> r:^tcp_wrappers-'
      - 'c:rpm -q tcp_wrappers-libs -> r:^tcp_wrappers-libs-'

# 3.4.3 Ensure /etc/hosts.deny is configured (Scored)
  - id: 5599 
    title: "Ensure /etc/hosts.deny is configured"
    description: "The /etc/hosts.deny file specifies which IP addresses are not permitted to connect to the host. It is intended to be used in conjunction with the /etc/hosts.allow file."
    rationale: "The /etc/hosts.allow file supports access control by IP and helps ensure that only authorized systems can connect to the system."
    remediation: "Run the following command to create /etc/hosts.deny: echo 'ALL: ALL' >> /etc/hosts.deny"
    compliance:
      - cis: ["3.4.3"]
      - cis_csc: ["9.2"]
      - pci_dss: ["1.3.5"]
    condition: all
    rules:
      - 'f:/etc/hosts.deny -> r:^ALL\s*:\s*ALL'

# 3.4.4 Ensure permissions on /etc/hosts.allow are configured (Scored)
  - id: 5600 
    title: "Ensure permissions on /etc/hosts.allow are configured."
    description: "The /etc/hosts.allow file contains networking information that is used by many applications and therefore must be readable for these applications to operate."
    rationale: "It is critical to ensure that the /etc/hosts.allow file is protected from unauthorized write access. Although it is protected by default, the file permissions could be changed either inadvertently or through malicious actions."
    remediation: "Run the following commands to set permissions on /etc/hosts.allow : chown root:root /etc/hosts.allow and chmod 644 /etc/hosts.allow"
    compliance:
      - cis: ["3.4.4"]
      - cis_csc: ["5.1"]
      - pci_dss: ["1.3.5"]
    condition: all
    rules:
      - 'c:stat /etc/hosts.allow -> r:^Access: \(0644/-rw-r--r--\)  Uid: \(    0/    root\)   Gid: \(    0/    root\)'


# 3.4.5 Ensure permissions on /etc/hosts.deny are configured (Scored)
  - id: 5601 
    title: "Ensure permissions on /etc/hosts.deny are configured."
    description: "The /etc/hosts.deny file contains network information that is used by many system applications and therefore must be readable for these applications to operate."
    rationale: "It is critical to ensure that the /etc/hosts.deny file is protected from unauthorized write access. Although it is protected by default, the file permissions could be changed either inadvertently or through malicious actions."
    remediation: "Run the following commands to set permissions on /etc/hosts.deny : chown root:root /etc/hosts.deny and chmod 644 /etc/hosts.deny"
    compliance:
      - cis: ["3.4.5"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
    condition: all
    rules:
      - 'c:stat /etc/hosts.deny -> r:^Access: \(0644/-rw-r--r--\)  Uid: \(    0/    root\)   Gid: \(    0/    root\)$'


###############################################
# 3.5 Uncommon Network Protocols
###############################################
# 3.5.1 Ensure DCCP is disabled (Not Scored)
  - id: 5602 
    title: "Ensure DCCP is disabled"
    description: "The Datagram Congestion Control Protocol (DCCP) is a transport layer protocol that supports streaming media and telephony. DCCP provides a way to gain access to congestion control, without having to do it at the application layer, but does not provide in-sequence delivery."
    rationale: "If the protocol is not required, it is recommended that the drivers not be installed to reduce
the potential attack surface."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install dccp /bin/true"
    compliance:
      - cis: ["3.5.1"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - 'c:modprobe -n -v dccp -> r:install /bin/true'
      - 'not c:lsmod -> r:dccp'



# 3.5.2 Ensure SCTP is disabled (Not Scored)
  - id: 5603 
    title: "Ensure SCTP is disabled"
    description: "The Stream Control Transmission Protocol (SCTP) is a transport layer protocol used to support message oriented communication, with several streams of messages in one connection. It serves a similar function as TCP and UDP, incorporating features of both. It is message-oriented like UDP, and ensures reliable in-sequence transport of messages with congestion control like TCP."
    rationale: "If the protocol is not being used, it is recommended that kernel module not be loaded, disabling the service to reduce the potential attack surface."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install sctp /bin/true"
    compliance:
      - cis: ["3.5.2"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - 'c:modprobe -n -v sctp -> r:install /bin/true'
      - 'not c:lsmod -> r:sctp'


# 3.5.3 Ensure RDS is disabled (Not Scored)
  - id: 5604 
    title: "Ensure RDS is disabled"
    description: "The Reliable Datagram Sockets (RDS) protocol is a transport layer protocol designed to provide low-latency, high-bandwidth communications between cluster nodes. It was developed by the Oracle Corporation."
    rationale: "If the protocol is not being used, it is recommended that kernel module not be loaded, disabling the service to reduce the potential attack surface."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install rds /bin/true"
    compliance:
      - cis: ["3.5.3"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - 'c:modprobe -n -v rds -> r:install /bin/true'
      - 'not c:lsmod -> r:rds'


# 3.5.4 Ensure TIPC is disabled (Not Scored)
  - id: 5605 
    title: "Ensure TIPC is disabled"
    description: "The Transparent Inter-Process Communication (TIPC) protocol is designed to provide communication between cluster nodes."
    rationale: "If the protocol is not being used, it is recommended that kernel module not be loaded, disabling the service to reduce the potential attack surface."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install tipc /bin/true"
    compliance:
      - cis: ["3.5.4"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - 'c:modprobe -n -v tipc -> r:install /bin/true'
      - 'not c:lsmod -> r:tipc'

###############################################
# 3.6 Firewall Configuration
###############################################
# 3.6.1 Ensure iptables is installed (Scored)
  - id: 5606 
    title: "Ensure iptables is installed"
    description: "iptables allows configuration of the IPv4 tables in the linux kernel and the rules stored within them. Most firewall configuration utilities operate as a front end to iptables ."
    rationale: "iptables is required for firewall management and configuration."
    remediation: "Run the following command to install iptables : yum install iptables"
    compliance:
      - cis: ["3.6.1"]
      - cis_csc: ["9.2"]
      - pci_dss: ["1.1"]
    condition: all
    rules:
      - 'c:rpm -q iptables -> r:iptables-'

# 3.6.2 Ensure default deny firewall policy (Scored)
  - id: 5607 
    title: "Ensure default deny firewall policy"
    description: "A default deny all policy on connections ensures that any unconfigured network usage will be rejected."
    rationale: "With a default accept policy the firewall will accept any packet that is not configured to be denied. It is easier to white list acceptable usage than to black list unacceptable usage."
    remediation: "Run the following commands to implement a default DROP policy: iptables -P INPUT DROP; iptables -P OUTPUT DROP and iptables -P FORWARD DROP"
    compliance:
      - cis: ["3.6.2"]
      - cis_csc: ["9.2"]
      - pci_dss: ["1.2.1"]
    condition: all
    rules:
      - 'c:iptables -L -> r:Chain INPUT \(policy DROP\)'
      - 'c:iptables -L -> r:Chain FORWARD \(policy DROP\)'
      - 'c:iptables -L -> r:Chain OUTPUT \(policy DROP\)'

# 3.6.3 Ensure loopback traffic is configured (Scored)
  - id: 5608 
    title: "Ensure loopback traffic is configured"
    description: "Configure the loopback interface to accept traffic. Configure all other interfaces to deny traffic to the loopback network (127.0.0.0/8)."
    rationale: "Loopback traffic is generated between processes on machine and is typically critical to operation of the system. The loopback interface is the only place that loopback network (127.0.0.0/8) traffic should be seen, all other interfaces should ignore traffic on this network as an anti-spoofing measure."
    remediation: "Run the following commands to implement the loopback rules: # iptables -A INPUT -i lo -j ACCEPT # iptables -A OUTPUT -o lo -j ACCEPT # iptables -A INPUT -s 127.0.0.0/8 -j DROP"
    compliance:
      - cis: ["3.6.3"]
      - cis_csc: ["9.2"]
      - pci_dss: ["1.2.1"]
    condition: all
    rules:
      - 'c:iptables -L INPUT -v -n -> r:\.*ACCEPT\.*all\.*lo\.**\.*0.0.0.0/0\.*0.0.0.0/0'
      - 'c:iptables -L INPUT -v -n -> r:\.*DROP\.*all\.**\.**\.*127.0.0.0/8\.*0.0.0.0/0'
      - 'c:iptables -L OUTPUT -v -n -> r:\.*ACCEPT\.*all\.**\.*lo\.*0.0.0.0/0\.*0.0.0.0/0'
