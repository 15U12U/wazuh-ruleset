# Security Configuration Assessment
# Level 2 CIS Checks for Debian Linux 10
# Copyright (C) 2015-2020, Wazuh Inc.
#
# This program is free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public
# License (version 2) as published by the FSF - Free Software
# Foundation
#
# Based on:
# Center for Internet Security Debian Linux 10 Benchmark v1.0.0 - 02-13-2020

policy:
  id: "cis_debian10_L2"
  file: "cis_debian10_L2.yml"
  name: "CIS benchmark for Debian/Linux 10 L2"
  description: "This document provides prescriptive guidance for establishing a secure configuration posture for Debian Linux 10."
  references:
    - https://www.cisecurity.org/cis-benchmarks/

requirements:
  title: "Check Debian version"
  description: "Requirements for running the SCA scan against Debian/Ubuntu."
  condition: all
  rules:
    - 'f:/etc/debian_version'
    - 'f:/proc/sys/kernel/ostype -> Linux'

checks:


############################################################
# 1 Initial Setup
############################################################



############################################################
# 2 Services
############################################################



############################################################
# 3 Network Configuration
############################################################
############################################################
# 3.1 Disable unused network protocols and devices
############################################################
# 3.1.1 Disable IPv6 (Not Scored)
  - id: 3800
    title: "Disable IPv6"
    description: "Although IPv6 has many advantages over IPv4, not all organizations have IPv6 or dual stack configurations implemented."
    rationale: "If IPv6 or dual stack is not to be used, it is recommended that IPv6 be disabled to reduce the attack surface of the system."
    remediation: "Edit /etc/default/grub and add ipv6.disable=1 to the GRUB_CMDLINE_LINUX parameters: GRUB_CMDLINE_LINUX=\"ipv6.disable=1\" Run the following command to update the grub2 configuration: # update-grub"
    compliance:
      - cis: ["3.1.1"]
      - cis_csc: ["9.4"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC6.6","CC5.2"]
    condition: none
    rules:
      - 'f:/boot/grub/grub.cfg -> r:^\s*linux && !r:ipv6.disable=1'

# 3.1.2 Ensure wireless interfaces are disabled (Scored)  
  - id: 3801 
    title: "Ensure wireless interfaces are disabled"
    description: "Wireless networking is used when wired networks are unavailable. Red Hat Enterprise Linux contains a wireless tool kit to allow system administrators to configure and use wireless networks."
    rationale: "If wireless is not to be used, wireless devices can be disabled to reduce the potential attack surface."
    remediation: "Run the following command to disable any wireless interfaces: # nmcli radio all off"
    compliance:
      - cis: ["3.1.2"]
      - cis_csc: ["15.4", "15.5"]
      - pci_dss: ["1.2.3"]
      - tsc: ["CC6.6"]
    references:
      - nmcli(1) - Linux man page
    condition: all
    rules:
      - 'c:nmcli radio wifi -> r:^disabled'
      - 'c:nmcli radio wwan -> r:^disabled'  


#####################################################################
# 3.4 Uncommon Network Protocols
#####################################################################
# 3.4.1 Ensure DCCP is disabled (Scored)
  - id: 3161
    title: "Ensure DCCP is disabled"
    description: "The Datagram Congestion Control Protocol (DCCP) is a transport layer protocol that supports streaming media and telephony. DCCP provides a way to gain access to congestion control, without having to do it at the application layer, but does not provide in- sequence delivery."
    rationale: "If the protocol is not required, it is recommended that the drivers not be installed to reduce the potential attack surface."
    remediation: "Edit or create a file in the /etc/modprobe.d/ directory ending in .conf Example: vim /etc/modprobe.d/dccp.conf and add the following line: install dccp /bin/true"
    compliance:
      - cis: ["3.4.1"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - 'not c:modprobe -n -v dccp -> r:install /bin/true'
      - 'c:lsmod -> r:dccp'

# 3.4.2 Ensure SCTP is disabled (Scored)
  - id: 3162
    title: "Ensure SCTP is disabled"
    description: "The Stream Control Transmission Protocol (SCTP) is a transport layer protocol used to support message oriented communication, with several streams of messages in one connection. It serves a similar function as TCP and UDP, incorporating features of both. It is message-oriented like UDP, and ensures reliable in-sequence transport of messages with congestion control like TCP."
    rationale: "If the protocol is not being used, it is recommended that kernel module not be loaded, disabling the service to reduce the potential attack surface."
    remediation: "Edit or create a file in the /etc/modprobe.d/ directory ending in .conf Example: vim /etc/modprobe.d/sctp.conf and add the following line: install sctp /bin/true"
    compliance:
      - cis: ["3.4.2"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - 'not c:modprobe -n -v sctp -> r:install /bin/true'
      - 'c:lsmod -> r:sctp'


# 3.4.3 Ensure RDS is disabled (Scored)
  - id: 3163
    title: "Ensure RDS is disabled"
    description: "The Reliable Datagram Sockets (RDS) protocol is a transport layer protocol designed to provide low-latency, high-bandwidth communications between cluster nodes. It was developed by the Oracle Corporation."
    rationale: "If the protocol is not being used, it is recommended that kernel module not be loaded, disabling the service to reduce the potential attack surface."
    remediation: "Edit or create a file in the /etc/modprobe.d/ directory ending in .conf Example: vim /etc/modprobe.d/rds.conf and add the following line: install rds /bin/true"
    compliance:
      - cis: ["3.4.3"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - 'not c:modprobe -n -v rds -> r:install /bin/true'
      - 'c:lsmod -> r:rds'

# 3.4.4 Ensure TIPC is disabled (Scored)
  - id: 3164
    title: "Ensure TIPC is disabled"
    description: "The Transparent Inter-Process Communication (TIPC) protocol is designed to provide communication between cluster nodes."
    rationale: "If the protocol is not being used, it is recommended that kernel module not be loaded, disabling the service to reduce the potential attack surface."
    remediation: "Edit or create a file in the /etc/modprobe.d/ directory ending in .conf Example: vim /etc/modprobe.d/tipc.conf and add the following line: install tipc /bin/true"
    compliance:
      - cis: ["3.4.4"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - 'not c:modprobe -n -v tipc -> r:install /bin/true'
      - 'c:lsmod -> r:tipc'

############################################################
# 4 Logging and Auditing
############################################################



############################################################
# 5 Access, Authentication and Authorization
############################################################
# 5.2.6 Ensure SSH X11 forwarding is disabled (Scored)
  - id: 3528
    title: "Ensure SSH X11 forwarding is disabled"
    description: "The X11Forwarding parameter provides the ability to tunnel X11 traffic through the connection to enable remote graphic connections."
    rationale: "Disable X11 forwarding unless there is an operational requirement to use X11 applications directly. There is a small risk that the remote X11 servers of users who are logged in via SSH with X11 forwarding could be compromised by other users on the X11 server. Note that even if X11 forwarding is disabled, users can always install their own forwarders."
    remediation: "Edit the /etc/ssh/sshd_configfile to set the parameter as follows: X11Forwarding no"
    compliance:
      - cis: ["5.2.6"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> r:X11Forwarding\s+no'

# 5.2.21 Ensure SSH AllowTcpForwarding is disabled (Scored)
  - id: 3419 
    title: "Ensure SSH AllowTcpForwarding is disabled"
    description: "SSH port forwarding is a mechanism in SSH for tunneling application ports from the client to the server, or servers to clients. It can be used for adding encryption to legacy applications, going through firewalls, and some system administrators and IT professionals use it for opening backdoors into the internal network from their home machines."
    rationale: "Leaving port forwarding enabled can expose the organization to security risks and back-doors. SSH connections are protected with strong encryption. This makes their contents invisible to most deployed network monitoring and traffic filtering solutions. This invisibility carries considerable risk potential if it is used for malicious purposes such as data exfiltration. Cybercriminals or malware could exploit SSH to hide their unauthorized communications, or to exfiltrate stolen data from the target network."
    remediation: "Edit the /etc/ssh/sshd_config file to set the parameter as follows: AllowTcpForwarding no"
    compliance:
      - cis: ["5.2.21"]
      - cis_csc: ["9.2"]
      - pci_dss: ["4.1"]
      - hipaa: ["164.312.a.2.IV", "164.312.e.1", "164.312.e.2.I", "164.312.e.2.II"]
      - nist_800_53: ["SC.8"]
      - tsc: ["CC6.1","CC6.7","CC7.2"]
    references:
      - https://www.ssh.com/ssh/tunneling/example
    condition: all
    rules:
      - 'c:sshd -T -> r:^\s*AllowTcpForwarding\s+no'

############################################################
# 6 System Maintenance
############################################################