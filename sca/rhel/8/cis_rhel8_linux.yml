# Security Configuration Assessment
# CIS Checks for RHEL 8
# Copyright (C) 2015-2020, Wazuh Inc.
#
# This program is free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public
# License (version 2) as published by the FSF - Free Software
# Foundation
#
# Based on:
# Center for Internet Security Red Hat Enterprise Linux 8 Benchmark v1.0 - 09-30-2019

policy:
  id: "cis_rhel8"
  file: "cis_rhel8_linux.yml"
  name: "CIS Benchmark for Red Hat Enterprise Linux 8"
  description: "This document provides prescriptive guidance for establishing a secure configuration posture for Red Hat Enterprise Linux 8 systems running on x86 and x64 platforms. This document was tested against Red Hat Enterprise Linux 8"
  references:
    - https://www.cisecurity.org/cis-benchmarks/

requirements:
  title: "Check RHEL8 family platform"
  description: "Requirements for running the policy against RHEL 8 family."
  condition: any
  rules:
    - 'f:/etc/redhat-release -> r:^Red Hat Enterprise Linux && r:release 8'
    - 'f:/etc/redhat-release -> r:^CentOS && r:release 8'
    - 'f:/etc/redhat-release -> r:^Cloud && r:release 8'
    - 'f:/etc/redhat-release -> r:^Oracle && r:release 8'
    - 'f:/etc/redhat-release -> r:^Better && r:release 8'
    - 'f:/etc/redhat-release -> r:^OpenVZ && r:release 8'
#    - 'f:/etc/system-release -> r:^Amazon && r:release 2'

variables:
  $sshd_file: /etc/ssh/sshd_config

checks:

###############################################
# 1 Initial setup
###############################################
###############################################
# 1.1 Filesystem Configuration
###############################################
# 1.1.1.1 cramfs: filesystem
  - id: 5500 
    title: "Ensure mounting of cramfs filesystems is disabled"
    description: "The cramfs filesystem type is a compressed read-only Linux filesystem embedded in small footprint systems. A cramfs image can be used without having to first decompress the image."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the server. If this filesystem type is not needed, disable it."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install cramfs /bin/true. Run the following command to unload the cramfs module: rmmod cramfs"
    compliance:
      - cis: ["1.1.1.1"]
      - cis_csc: ["5.1"]
    condition: all
    rules:
      - 'c:modprobe -n -v cramfs -> r:install /bin/true|Module cramfs not found'
      - 'not c:lsmod -> r:cramfs'
# 1.1.1.2 vFAT: filesystem       REVIEW
  - id: 5507 
    title: "Ensure mounting of FAT filesystems is limited"
    description: "The VFAT filesystem format is primarily used on older windows systems and portable USB drives or flash modules. It comes in three types FAT12 , FAT16 , and FAT32 all of which are supported by the vfat kernel module."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install vfat /bin/true. Run the following command to unload the vfat module: rmmod vfat"
    compliance:
      - cis: ["1.1.1.2"]
      - cis_csc: ["5.1"]
    condition: all
    rules:
      - 'c:modprobe -n -v vfat -> r:install /bin/true|Module vfat not found'
      - 'not c:lsmod -> r:vfat'

# 1.1.1.3 squashfs: filesystem
  - id: 5505 
    title: "Ensure mounting of squashfs filesystems is disabled"
    description: "The squashfs filesystem type is a compressed read-only Linux filesystem embedded in small footprint systems (similar to cramfs ). A squashfs image can be used without having to first decompress the image."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install squashfs /bin/true. Run the following command to unload the squashfs module: rmmod squashfs"
    compliance:
      - cis: ["1.1.1.3"]
      - cis_csc: ["5.1"]
    condition: all
    rules:
      - 'c:modprobe -n -v squashfs -> r:install /bin/true|Module squashfs not found'
      - 'not c:lsmod -> r:squashfs'

# 1.1.1.4 udfs: filesystem
  - id: 5506 
    title: "Ensure mounting of udf filesystems is disabled"
    description: "The udf filesystem type is the universal disk format used to implement ISO/IEC 13346 and ECMA-167 specifications. This is an open vendor filesystem type for data storage on a broad range of media. This filesystem type is necessary to support writing DVDs and newer optical disc formats."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Edit or create the file /etc/modprobe.d/CIS.conf and add the following line: install udf /bin/true. Run the following command to unload the udf module: rmmod udf"
    compliance:
      - cis: ["1.1.1.4"]
      - cis_csc: ["5.1"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:modprobe -n -v udf -> r:install /bin/true|Module udf not found'
      - 'not c:lsmod -> r:udf'
# 1.1.2 /tmp: partition
  - id: 5500
    title: "Ensure separate partition exists for /tmp"
    description: "The /tmp directory is a world-writable directory used for temporary storage by all users and some applications."
    rationale: "Since the /tmp directory is intended to be world-writable, there is a risk of resource exhaustion if it is not bound to a separate partition. In addition, making /tmp its own file system allows an administrator to set the noexec option on the mount, making /tmp useless for an attacker to install executable code."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /tmp. For systems that were previously installed, create a new partition for /tmp if not using tmpfs. Enable systemd /tmp mounting"
    compliance:
      - cis: ["1.1.2"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:mount -> r:\s/tmp\s'